{"id":"aw-1qo","title":"Implement aw init cloud bootstrap fallback","description":"Update aw init to support hosted aweb-cloud where /v1/init is unavailable by falling back to authenticated cloud bootstrap endpoint.","design":"Keep OSS /v1/init as primary path. On 403/404 from init, call cloud /api/v1/agents/bootstrap using --cloud-token or AWEB_CLOUD_TOKEN, normalize /api base URLs, and preserve existing init output/config contract.","acceptance_criteria":"1) OSS init behavior unchanged. 2) Cloud fallback issues API key via /api/v1/agents/bootstrap. 3) Works when base URL includes /api. 4) Tests cover fallback success and missing-token failure.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-06T13:02:38.43577Z","created_by":"Juan Reyero","updated_at":"2026-02-06T13:02:49.3632Z","closed_at":"2026-02-06T13:02:49.3632Z","close_reason":"Closed"}
{"id":"aw-344","title":"Add 'aw mail ack' CLI command","description":"AckMessage() client method exists but no CLI command exposes it. Add 'aw mail ack' subcommand that calls POST /v1/messages/{message_id}/ack. Takes --message-id flag.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:06.273275Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.201816Z","closed_at":"2026-02-04T11:33:26.201816Z","close_reason":"Closed"}
{"id":"aw-43q","title":"Replace chat send with send-and-wait / send-and-leave verbs","description":"## Problem\n\nAgents get trapped in 120s waits because the default chat send behavior is ambiguous. When replying to a message, agents forget --leave-conversation and silently wait for a counter-reply that never comes.\n\n## Solution\n\nReplace the ambiguous chat send with two explicit verbs:\n\n- chat send-and-wait \u003calias\u003e \u003cmsg\u003e — send and wait for reply (120s default)\n  - --start-conversation: 5 min wait (initiating new exchange)\n  - --wait N: custom wait duration\n- chat send-and-leave \u003calias\u003e \u003cmsg\u003e — send with leaving=true, exit immediately\n\nRemove bare chat send entirely. Every send must declare intent.\n\n## Files to update\n\n### aw repo (this repo)\n- cmd/aw/chat.go: replace chatSendCmd with two new commands\n- cmd/aw/aw_test.go: update any chat send tests\n- README.md: update CLI docs\n- skills/aweb/SKILL.md: update command list\n- skills/aweb/resources/COORDINATION_PATTERNS.md: update examples\n\n### bdh repo (alice-coordinator)\n- internal/commands/chat.go: replace send subcommand with two verbs\n- internal/commands/chat_test.go: update tests\n- internal/commands/agent_docs.go: update help templates\n- README.md\n\n### beadhub repo (alice-coordinator)\n- src/beadhub/defaults/invariants/03-communication-chat.md: update subcommand table and examples\n- src/beadhub/defaults/roles/backend.md, frontend.md: update examples\n\n### aweb-cloud repo (ivy-implementer)\n- .release-deps/beadhub/: will get updated on next beadhub release\n\n### beadhub-sot\n- archive/beadhub-chat-spec.md: update CLI section","status":"in_progress","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:38:53.481501Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:38:58.622794Z"}
{"id":"aw-67s","title":"Harden aw init cloud mode token resolution and URL normalization","description":"Improve aw init cloud path by adding strict cloud mode, resilient cloud token selection across server-key/host mismatches, and /api/v1 normalization for cloud bootstrap.","design":"Add --cloud mode to skip /v1/init probing, broaden credential lookup order to include configured accounts by server key and URL host, and normalize cloud root URL for /api and /api/v1 suffixes. Add integration tests for each case.","acceptance_criteria":"1) --cloud mode never probes /v1/init. 2) Configured cloud token is found even when server key and URL host differ. 3) /api/v1 URLs bootstrap correctly. 4) Tests cover all scenarios.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-06T14:29:12.765284Z","created_by":"Juan Reyero","updated_at":"2026-02-06T14:29:30.59162Z","closed_at":"2026-02-06T14:29:30.59162Z","close_reason":"Closed"}
{"id":"aw-68m","title":"Migrate aw CLI from stdlib flag to cobra","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T13:51:52.982318Z","created_by":"Juan Reyero","updated_at":"2026-02-04T17:04:37.2508Z","closed_at":"2026-02-04T17:04:37.2508Z","close_reason":"Migrated from stdlib flag to spf13/cobra; flags now work in any position"}
{"id":"aw-7l4","title":"Add 'aw lock renew' CLI command","description":"ReservationRenew() client method exists but no CLI command exposes it. Add 'aw lock renew' subcommand that calls POST /v1/reservations/renew. Takes --resource-key and optional --ttl-seconds flags.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:06.66056Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.213143Z","closed_at":"2026-02-04T11:33:26.213143Z","close_reason":"Closed"}
{"id":"aw-8gi","title":"Fix inconsistent CLI error messages for missing flags","description":"runLockAcquire and runLockRelease say 'Missing required flags' (generic plural) while runLockRenew and runMailAck say 'Missing required flag: --flag-name' (specific). Standardize all missing-flag errors to name the specific missing flag.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:10.796835Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:13:39.566424Z","closed_at":"2026-02-06T18:13:39.566424Z","close_reason":"Standardized missing-flag errors and added --debug/AW_DEBUG for background error visibility"}
{"id":"aw-cnn","title":"Add 'aw agents' CLI command","description":"ListAgents() client method exists but no CLI command exposes it. Add 'aw agents' command that calls GET /v1/agents and outputs agent list as JSON. Response includes agent_id, alias, human_name, agent_type, status, last_seen, online.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:05.879432Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.191214Z","closed_at":"2026-02-04T11:33:26.191214Z","close_reason":"Closed"}
{"id":"aw-e1p","title":"Add --debug flag for heartbeat and background error visibility","description":"fireHeartbeat() silently swallows all errors. Agents may appear offline with no feedback. Add a --debug flag or AW_DEBUG env var that logs background errors (heartbeat failures, config resolution issues) to stderr.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:15.271576Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:13:39.568753Z","closed_at":"2026-02-06T18:13:39.568753Z","close_reason":"Standardized missing-flag errors and added --debug/AW_DEBUG for background error visibility"}
{"id":"aw-grj","title":"Add ReservationRevoke() client method and 'aw lock revoke' CLI command","description":"POST /v1/reservations/revoke endpoint has no Go client method. Add ReservationRevoke() to client library and 'aw lock revoke' CLI command. Request: {prefix (optional)}. Response: {revoked_count, revoked_keys}.","status":"closed","priority":3,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:09.409342Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.234668Z","closed_at":"2026-02-04T11:33:26.234668Z","close_reason":"Closed"}
{"id":"aw-j80","title":"Design: explicit send-and-wait / send-and-leave chat protocol","description":"## Problem\n\nAgents coordinating via chat get trapped in 120-second waits. The most common failure: an agent replies to a waiting sender but forgets --leave-conversation, blocking for 120s waiting for a counter-reply that never comes.\n\nThe deeper issue: the protocol doesn't propagate wait state. When you receive a message, you don't know if the sender is sitting there waiting for your response. And when you reply, the default behavior (wait 120s) assumes you're starting a new exchange, not answering one.\n\n## Correct Protocol\n\nThe rule is simple: **always wait after sending, unless the other party left in the previous round.**\n\n### Flow\n\n1. A sends and waits (--start-conversation, 5 min)\n2. B sees the message, sends reply and waits (default 120s)\n3. A gets B's reply. A knows B is waiting (sender_waiting=true in the SSE event). A thinks, writes back, and leaves (--leave-conversation).\n4. B receives A's reply plus the info that A is not waiting (sender_leaving=true). B either replies-and-leaves, or just stops.\n\nThe agent that ends the conversation MUST make it explicit. Otherwise the other agent will, by default, reply and wait — and get trapped.\n\n## What's Missing\n\n### 1. Receiving agent doesn't know if sender is waiting\n\nWhen B receives a message via SSE, the event doesn't include sender_waiting. B can't tell if A is sitting there expecting a reply or if A fired-and-forgot. This should be appended to every message event so the receiving agent always knows.\n\n### 2. Leaving can't be signaled via ChatSendMessage\n\nCurrently leaving can only be signaled via ChatCreateSession (alias-based). ChatSendMessage (session-ID-based) has no Leaving field, so there's no way to leave via the session-ID path. This is inconsistent with HangOn which works on both.\n\n### 3. Default behavior is ambiguous\n\nThe current flags are:\n- --start-conversation: wait 5 min\n- --leave-conversation: send and exit\n- (default): wait 120s\n\nThe problem is the default. \"wait 120s\" is correct for continuing a conversation but wrong for a final reply. Agents must remember to add --leave-conversation, and they forget.\n\nConsider making the intent more explicit, e.g.:\n- send-and-wait: \"I expect a reply, wait for it\"\n- send-and-leave: \"I'm done, don't wait\"\n\nThis removes the ambiguous default and forces every send to declare intent.\n\n## Implementation Phases\n\n### Phase A: Wire protocol gaps (client-only, backward compatible)\n\n1. Add Leaving field to ChatSendMessageRequest and NetworkChatSendMessageRequest (omitempty, server ignores unknown fields)\n2. Add SenderWaiting field to Event struct, parse sender_waiting from SSE events\n3. Add SenderWaiting to ChatSessionItem for when server starts including it\n\n### Phase B: Server-side sender_waiting propagation\n\nWhen B sends a message while waiting on SSE, the message event delivered to A should include sender_waiting: true. This lets A know B expects a reply. Server needs to:\n- Include sender_waiting in SSE message events\n- Include sender_waiting in ChatSessionItem (list sessions response)\n\n### Phase C: UX — make wait intent explicit\n\nEvaluate whether to replace the ambiguous default with explicit send-and-wait / send-and-leave semantics. This is a UX decision that affects how bdh :aweb chat commands work.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T22:51:54.004605Z","created_by":"Juan Reyero","updated_at":"2026-02-07T22:54:49.675755Z","closed_at":"2026-02-07T22:54:49.675755Z","close_reason":"Phase A wire protocol gaps implemented: Leaving on ChatSendMessage, SenderWaiting on SSE events, propagation to SendResult. Phases B (server) and C (UX) remain as future work."}
{"id":"aw-ktk","title":"Update usage() help text with new commands","description":"After adding agents, mail ack, lock renew, project, and lock revoke commands, update the usage() function in main.go to include them all.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:15.423781Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.245296Z","closed_at":"2026-02-04T11:33:26.245296Z","close_reason":"Closed"}
{"id":"aw-lmj","title":"Fix SSE goroutine leak in chat Send()","description":"In chat/chat.go Send(), streamToChannel() goroutine may leak if context cancels while it's reading from the SSE stream. defer stream.Close() may close the stream while the goroutine is still reading. Need explicit synchronization or errgroup to ensure clean shutdown.","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:04.190574Z","created_by":"Juan Reyero","updated_at":"2026-02-06T16:31:43.628759Z","closed_at":"2026-02-06T16:31:43.628759Z","close_reason":"Fixed goroutine leak in streamToChannel: returns cleanup func that closes stream, cancels goroutine, waits for exit. Channel sends use select to avoid blocking on full buffer."}
{"id":"aw-mwx","title":"Split main.go into per-command files","description":"cmd/aw/main.go is 1000+ lines with all CLI command handlers. Split into separate files by command group (e.g. mail.go, chat.go, lock.go, agents.go) for maintainability. Keep main() and usage() in main.go.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:12.972738Z","created_by":"Juan Reyero","updated_at":"2026-02-04T17:04:36.871956Z","closed_at":"2026-02-04T17:04:36.871956Z","close_reason":"Split main.go into per-command files as part of cobra migration"}
{"id":"aw-nv6","title":"Make worktree context file writes atomic","description":"awconfig/context.go SaveWorktreeContextTo() uses os.WriteFile directly, unlike global config which uses temp-file-and-rename. Process kill during write could corrupt the context file. Should use the same atomic write pattern as global_config.go.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:08.259993Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:02:04.991052Z","closed_at":"2026-02-06T18:02:04.991052Z","close_reason":"Extracted atomicWriteFile() helper with chmod-before-write pattern. Both SaveGlobalTo and SaveWorktreeContextTo now use it."}
{"id":"aw-oo0","title":"Fix config temp file permissions window","description":"In awconfig/global_config.go, os.CreateTemp uses default umask before API key data is written. There's a brief window where the temp file may have overly permissive mode. Should explicitly chmod the temp file before writing sensitive data, or use os.OpenFile with restrictive mode.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:06.461644Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:02:04.989149Z","closed_at":"2026-02-06T18:02:04.989149Z","close_reason":"Extracted atomicWriteFile() helper with chmod-before-write pattern. Both SaveGlobalTo and SaveWorktreeContextTo now use it."}
{"id":"aw-p1b","title":"Refactor chat CLI: positional args and rename --leaving","description":"Per alignment with Alice (bdh-2et): (1) Change chat subcommands to use positional args for required params (alias, message) instead of flags. (2) Rename --leaving to --leave-conversation on chat send. (3) Update usage() text. (4) Update tests. Affects: runChatSend, runChatOpen, runChatHistory, runChatHangOn, runChatShowPending.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T13:06:15.072938Z","created_by":"Juan Reyero","updated_at":"2026-02-04T13:09:43.551718Z","closed_at":"2026-02-04T13:09:43.551718Z","close_reason":"All 5 chat subcommands refactored to positional args, --leaving renamed to --leave-conversation, usage text updated, tests pass."}
{"id":"aw-sw6","title":"Add GetCurrentProject() client method and 'aw project' CLI command","description":"GET /v1/projects/current endpoint has no Go client method. Add GetCurrentProject() to client library and 'aw project' CLI command. Response: {project_id, slug, name}.","status":"closed","priority":3,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:07.861134Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.223899Z","closed_at":"2026-02-04T11:33:26.223899Z","close_reason":"Closed"}
{"id":"aw-y1s","title":"Skip wait when target is connected on reply","description":"When Send() sees all targets in TargetsConnected and caller didn't explicitly request waiting (no --start-conversation, no --wait), return immediately with 'delivered' status instead of opening SSE and waiting 120s. Also add Leaving to ChatSendMessageRequest and SenderWaiting to SSE event parsing.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T22:38:11.926959Z","created_by":"Juan Reyero","updated_at":"2026-02-07T22:41:53.865428Z","closed_at":"2026-02-07T22:41:53.865428Z","close_reason":"All 3 phases implemented: (1) Skip wait when TargetsConnected, (2) Leaving on ChatSendMessageRequest, (3) SenderWaiting on SSE events. 37 tests pass."}
