{"id":"aw-018","title":"Leaving field on ChatSendMessageRequest is dead wire","description":"Grace confirmed: POST /sessions/{id}/messages hardcodes sender_leaving=false server-side (chat.py:829). Only POST /v1/chat/sessions (ChatCreateSession) honors the leaving field. Our send-and-leave verb works because it uses ChatCreateSession, but the Leaving field we added to ChatSendMessageRequest in Phase A does nothing. Either remove it from the client type or ask grace to add server support.","status":"closed","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T08:50:35Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:50:08Z","closed_at":"2026-02-08T09:50:08Z","close_reason":"Removed dead Leaving field from ChatSendMessageRequest and NetworkChatSendMessageRequest. Server only honors leaving on session creation. All tests pass."}
{"id":"aw-061","title":"Replace fragile mockHandler prefix matching in chat tests","description":"The mockHandler in chat_test.go uses map iteration (undefined order) for prefix matching of parameterized paths. This is fragile — if two handlers share a prefix, behavior is non-deterministic.\n\nSeveral tests already work around this with explicit path guards:\n  if r.URL.Path != \"/v1/chat/sessions\" { http.NotFound(w, r); return }\n\nThis pattern appears in TestOpenFallbackToListSessions, TestFindSessionFallback, TestFindSessionNotFound, TestFindSessionPrefersSmallestFallback, TestListenNoSession.\n\nFix: Replace prefix matching with proper path routing. Options:\n- Use http.ServeMux (Go 1.22+ supports method+path patterns)\n- Use exact matching only, register parameterized paths explicitly per test\n- Use a simple trie or ordered slice instead of a map\n\nFiles: chat/chat_test.go","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:25:16Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:47:17Z","closed_at":"2026-02-08T09:47:17Z","close_reason":"Removed prefix matching from mockHandler, using exact method+path matching only. Removed 5 path-checking workarounds. All 37 tests pass."}
{"id":"aw-0np","title":"Network chat send-and-wait doesn't wait (no SSE streaming)","description":"The network path for send-and-wait (org/alias addresses) calls NetworkCreateChat and returns immediately without opening an SSE stream. The server returns sse_url in the response but the client never connects to it. This means cross-org send-and-wait is actually fire-and-forget, violating the protocol rule: always wait unless the interlocutor left. The fix is to connect to the returned sse_url and wait for a reply, same as the OSS path does via chat.Send(). This would also fix the output schema inconsistency (network returns NetworkChatCreateResponse, OSS returns SendResult).","notes":"Ivy confirmed (aweb-cloud): SSE streaming works for network chat via /api/v1/network/chat/{session_id}/stream (cloud endpoint). The sse_url in NetworkChatCreateResponse already points there. Client needs same auth + deadline query param. Fix: after NetworkCreateChat(), open SSE stream at server_url+sse_url and wait, same as OSS path.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T08:37:52Z","created_by":"Juan Reyero","updated_at":"2026-02-08T08:57:02Z","closed_at":"2026-02-08T08:57:02Z","close_reason":"SendNetwork() added with full SSE streaming. Both OSS and network paths share sendCommon() waiting logic. Output schema unified to SendResult. All tests pass."}
{"id":"aw-1qo","title":"Implement aw init cloud bootstrap fallback","description":"Update aw init to support hosted aweb-cloud where /v1/init is unavailable by falling back to authenticated cloud bootstrap endpoint.","design":"Keep OSS /v1/init as primary path. On 403/404 from init, call cloud /api/v1/agents/bootstrap using --cloud-token or AWEB_CLOUD_TOKEN, normalize /api base URLs, and preserve existing init output/config contract.","acceptance_criteria":"1) OSS init behavior unchanged. 2) Cloud fallback issues API key via /api/v1/agents/bootstrap. 3) Works when base URL includes /api. 4) Tests cover fallback success and missing-token failure.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-06T13:02:38Z","created_by":"Juan Reyero","updated_at":"2026-02-06T13:02:49Z","closed_at":"2026-02-06T13:02:49Z","close_reason":"Closed"}
{"id":"aw-1zx","title":"Add identity fields and verification to chat SSE stream events","description":"The chat/types.go Event struct lacks identity fields (FromDID, Signature, etc). parseSSEEvent in chat/chat.go does not extract these or call VerifyMessage. SSE stream messages (the primary real-time path) are not verified. Add identity fields to Event, extract them in parseSSEEvent, and verify. SoT §7: 'ChatStream SSE events → verify each message event'.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-22T13:45:34Z","created_by":"Juan Reyero","updated_at":"2026-02-22T14:41:26Z","closed_at":"2026-02-22T14:41:26Z","close_reason":"Identity fields + verification in parseSSEEvent. Code reviewed."}
{"id":"aw-22o","title":"Handle EMAIL_VERIFICATION_REQUIRED 403 in CLI","description":"When any CLI command gets a 403 with error.code=EMAIL_VERIFICATION_REQUIRED, print friendly message with masked_email from details and suggest running aw verify. Currently all 403s show generic error.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-19T13:06:06Z","created_by":"Juan Reyero","updated_at":"2026-02-19T13:41:29Z","closed_at":"2026-02-19T13:41:29Z","close_reason":"Implemented checkVerificationRequired() in helpers.go. fatal() now intercepts EMAIL_VERIFICATION_REQUIRED 403 and shows user-friendly hint with masked email and aw verify instructions. Table-driven integration test covers both with/without masked email branches.","dependencies":[{"issue_id":"aw-22o","depends_on_id":"aw-c32","type":"blocks","created_at":"2026-02-19T13:06:48Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-2yx","title":"Listen returns misleading Status 'sent' on timeout","description":"Listen returns SendResult with Status='sent' on timeout, but nothing was sent. The comment acknowledges this: 'Returns *SendResult for compatibility with existing formatting code.'\n\nThe semantic mismatch can confuse consumers. Consider:\n- Adding a ListenResult type (or using a more generic name like ChatResult)\n- Or at minimum, using Status='timeout' instead of 'sent' for Listen timeouts\n\nThis is low priority since it's an internal API used by cmd/aw/chat.go, but it will cause confusion if other consumers use the chat package.\n\nFiles: chat/chat.go (Listen), chat/types.go","status":"closed","priority":4,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:25:21Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:41:03Z","closed_at":"2026-02-08T09:41:03Z","close_reason":"waitForMessage returns 'timeout', sendCommon maps to 'sent' for backward compat. All 37 tests pass.","dependencies":[{"issue_id":"aw-2yx","depends_on_id":"aw-w7a","type":"blocks","created_at":"2026-02-18T16:59:14Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aw-344","title":"Add 'aw mail ack' CLI command","description":"AckMessage() client method exists but no CLI command exposes it. Add 'aw mail ack' subcommand that calls POST /v1/messages/{message_id}/ack. Takes --message-id flag.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:06Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26Z","closed_at":"2026-02-04T11:33:26Z","close_reason":"Closed"}
{"id":"aw-349","title":"Add post-register verification code prompt","description":"After successful aw register, prompt user to enter 6-digit verification code from email. TTY-aware: skip prompt in non-interactive mode, just print instructions. Call POST /api/v1/verify-code with email+code.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-19T13:05:52Z","created_by":"Juan Reyero","updated_at":"2026-02-19T13:31:56Z","closed_at":"2026-02-19T13:31:56Z","close_reason":"Post-register verification prompt implemented, TTY-aware, with test","dependencies":[{"issue_id":"aw-349","depends_on_id":"aw-awb","type":"blocks","created_at":"2026-02-19T13:06:43Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-349","depends_on_id":"aw-vin","type":"blocks","created_at":"2026-02-19T13:06:41Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-43q","title":"Replace chat send with send-and-wait / send-and-leave verbs","description":"## Problem\n\nAgents get trapped in 120s waits because the default chat send behavior is ambiguous. When replying to a message, agents forget --leave-conversation and silently wait for a counter-reply that never comes.\n\n## Solution\n\nReplace the ambiguous chat send with two explicit verbs:\n\n- chat send-and-wait \u003calias\u003e \u003cmsg\u003e — send and wait for reply (120s default)\n  - --start-conversation: 5 min wait (initiating new exchange)\n  - --wait N: custom wait duration\n- chat send-and-leave \u003calias\u003e \u003cmsg\u003e — send with leaving=true, exit immediately\n\nRemove bare chat send entirely. Every send must declare intent.\n\n## Files to update\n\n### aw repo (this repo)\n- cmd/aw/chat.go: replace chatSendCmd with two new commands\n- cmd/aw/aw_test.go: update any chat send tests\n- README.md: update CLI docs\n- skills/aweb/SKILL.md: update command list\n- skills/aweb/resources/COORDINATION_PATTERNS.md: update examples\n\n### bdh repo (alice-coordinator)\n- internal/commands/chat.go: replace send subcommand with two verbs\n- internal/commands/chat_test.go: update tests\n- internal/commands/agent_docs.go: update help templates\n- README.md\n\n### beadhub repo (alice-coordinator)\n- src/beadhub/defaults/invariants/03-communication-chat.md: update subcommand table and examples\n- src/beadhub/defaults/roles/backend.md, frontend.md: update examples\n\n### aweb-cloud repo (ivy-implementer)\n- .release-deps/beadhub/: will get updated on next beadhub release\n\n### beadhub-sot\n- archive/beadhub-chat-spec.md: update CLI section","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:38:53Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:43:49Z","closed_at":"2026-02-07T23:43:49Z","close_reason":"Implemented send-and-wait/send-and-leave CLI verbs, updated all docs and tests, notified all stakeholders. Branch feat/chat-send-and-wait-leave pushed."}
{"id":"aw-67s","title":"Harden aw init cloud mode token resolution and URL normalization","description":"Improve aw init cloud path by adding strict cloud mode, resilient cloud token selection across server-key/host mismatches, and /api/v1 normalization for cloud bootstrap.","design":"Add --cloud mode to skip /v1/init probing, broaden credential lookup order to include configured accounts by server key and URL host, and normalize cloud root URL for /api and /api/v1 suffixes. Add integration tests for each case.","acceptance_criteria":"1) --cloud mode never probes /v1/init. 2) Configured cloud token is found even when server key and URL host differ. 3) /api/v1 URLs bootstrap correctly. 4) Tests cover all scenarios.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-06T14:29:13Z","created_by":"Juan Reyero","updated_at":"2026-02-06T14:29:31Z","closed_at":"2026-02-06T14:29:31Z","close_reason":"Closed"}
{"id":"aw-68m","title":"Migrate aw CLI from stdlib flag to cobra","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T13:51:53Z","created_by":"Juan Reyero","updated_at":"2026-02-04T17:04:37Z","closed_at":"2026-02-04T17:04:37Z","close_reason":"Migrated from stdlib flag to spf13/cobra; flags now work in any position"}
{"id":"aw-6ep","title":"Fix Listen to not accept replayed historical messages","description":"Listen uses an acceptAll acceptor that grabs the first SSE event it sees. Since the SSE stream replays historical messages, Listen immediately returns the oldest message in the conversation instead of waiting for new ones.\n\nFix: Once the server supports the 'after' parameter, Listen passes no 'after' value so the server skips replay entirely. Listen then only receives genuinely new messages.\n\nInterim workaround (if needed before server change): snapshot the latest message ID via ChatHistory(limit=1) before opening SSE, use an acceptor that skips until past that ID.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T11:52:04Z","created_by":"Juan Reyero","updated_at":"2026-02-08T12:18:11Z","closed_at":"2026-02-08T12:18:11Z","close_reason":"Implemented in commit c40f1b8: ChatStream/NetworkChatStream accept after param, Send passes sentAt timestamp, Listen passes nil, skipped replay events filtered from result.Events","dependencies":[{"issue_id":"aw-6ep","depends_on_id":"aw-sb5","type":"blocks","created_at":"2026-02-18T16:59:14Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aw-6k7","title":"@handle human DM addressing","description":"Check for @ prefix in mail send to route to POST /v1/network/dm endpoint. New dm.go library file with SendDM client method.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-21T11:54:24Z","created_by":"Juan Reyero","updated_at":"2026-02-21T12:01:49Z","closed_at":"2026-02-21T12:01:49Z","close_reason":"Added @handle DM routing in mail send with SendDM client method"}
{"id":"aw-6si","title":"Handle USERNAME_TAKEN and ALIAS_TAKEN 409 errors in aw register","description":"Parse structured 409 errors from server. USERNAME_TAKEN includes attempted_username and source (email_derived or explicit). ALIAS_TAKEN includes attempted alias. Print clear messages so the calling agent/human knows to retry with different values.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-19T13:05:38Z","created_by":"Juan Reyero","updated_at":"2026-02-19T13:21:55Z","closed_at":"2026-02-19T13:21:55Z","close_reason":"Structured 409 parsing for USERNAME_TAKEN and ALIAS_TAKEN with clear CLI messages","dependencies":[{"issue_id":"aw-6si","depends_on_id":"aw-awb","type":"blocks","created_at":"2026-02-19T13:06:38Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-7dv","title":"aw block/unblock commands","description":"New block.go library with Block/Unblock/ListBlocked client methods. New cmd/aw/block.go with aw block, aw block list, aw unblock cobra commands.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-21T11:54:28Z","created_by":"Juan Reyero","updated_at":"2026-02-21T12:07:17Z","closed_at":"2026-02-21T12:07:17Z","close_reason":"Added block/unblock commands with review fixes (JSON unblock output, stronger agent-level test assertions)"}
{"id":"aw-7l4","title":"Add 'aw lock renew' CLI command","description":"ReservationRenew() client method exists but no CLI command exposes it. Add 'aw lock renew' subcommand that calls POST /v1/reservations/renew. Takes --resource-key and optional --ttl-seconds flags.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:07Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26Z","closed_at":"2026-02-04T11:33:26Z","close_reason":"Closed"}
{"id":"aw-7xi","title":"aw init --namespace flag","description":"Add --namespace flag to aw init that forces cloud mode and passes namespace_slug to cloud bootstrap. Requires --alias.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-21T11:54:33Z","created_by":"Juan Reyero","updated_at":"2026-02-21T12:13:31Z","closed_at":"2026-02-21T12:13:31Z","close_reason":"Added --namespace flag with cloud mode forcing, alias requirement, and namespace propagation","dependencies":[{"issue_id":"aw-7xi","depends_on_id":"aw-ejt","type":"blocks","created_at":"2026-02-21T11:54:40Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-8gi","title":"Fix inconsistent CLI error messages for missing flags","description":"runLockAcquire and runLockRelease say 'Missing required flags' (generic plural) while runLockRenew and runMailAck say 'Missing required flag: --flag-name' (specific). Standardize all missing-flag errors to name the specific missing flag.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:11Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:13:40Z","closed_at":"2026-02-06T18:13:40Z","close_reason":"Standardized missing-flag errors and added --debug/AW_DEBUG for background error visibility"}
{"id":"aw-9g9","title":"CLI: create identity-capable client when signing key present","description":"mustResolve() in cmd/aw/helpers.go always builds the client with NewWithAPIKey(baseURL, sel.APIKey) and never uses sel.SigningKey/sel.DID to construct NewWithIdentity. Result: outbound mail/chat/network sends don't carry client signatures even for self-custody accounts. All the signing infrastructure we built (signEnvelope, MessageID, canonical JSON) is dead code in production CLI.\n\nFix: when sel.SigningKey and sel.DID are both present, use NewWithIdentity(baseURL, sel.APIKey, sel.SigningKey, sel.DID) instead of NewWithAPIKey. Fall back to NewWithAPIKey when identity fields are absent (legacy/custodial accounts).\n\nFiles: cmd/aw/helpers.go (mustResolve and/or mustClient)\nRef: Tara's SOT audit finding #1","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-22T18:32:14Z","created_by":"Juan Reyero","updated_at":"2026-02-22T18:55:10Z","closed_at":"2026-02-22T18:55:10Z","close_reason":"Fixed in mustResolve: identity client + SetAddress when signing key present"}
{"id":"aw-am0","title":"CLI: set client address for signed envelopes","description":"client.go signEnvelope() sets env.From = c.address, but c.address is never set by production CLI code. SetAddress() exists but is only called in tests (client_test.go). Result: even once we enable identity-capable client creation (aw-9g9), the From field in signed envelopes will be empty.\n\nFix: after creating the client with NewWithIdentity in mustResolve/mustClient, call c.SetAddress() with the agent's canonical address derived from the selection (namespace/alias or project/alias). The address is available from sel fields.\n\nTwo options:\na) Add address parameter to NewWithIdentity\nb) Call SetAddress() in mustResolve() after client creation\n\nOption (b) is simpler and matches the existing API surface.\n\nFiles: cmd/aw/helpers.go\nDepends on: aw-9g9\nRef: Tara's SOT audit finding #2","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-22T18:32:26Z","created_by":"Juan Reyero","updated_at":"2026-02-22T18:55:10Z","closed_at":"2026-02-22T18:55:10Z","close_reason":"Fixed in mustResolve: identity client + SetAddress when signing key present","dependencies":[{"issue_id":"aw-am0","depends_on_id":"aw-9g9","type":"blocks","created_at":"2026-02-22T18:33:30Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-awb","title":"Make --username and --alias required on aw register","description":"Remove auto-allocation. Both flags required. Username is user identity, alias is agent public address. No defaulting from email, no name pool.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-19T13:05:30Z","created_by":"Juan Reyero","updated_at":"2026-02-19T13:14:07Z","closed_at":"2026-02-19T13:14:07Z","close_reason":"--username and --alias now required on aw register, with tests"}
{"id":"aw-bqz","title":"retire.go and did.go bypass URL probing when creating identity client","description":"retire.go (line 50) and did.go (line 72) construct NewWithIdentity clients using raw sel.BaseURL without going through resolveWorkingBaseURL(). This means key rotation and agent retirement bypass the URL-probing logic that mustResolve() performs (trying /api suffix, stripping /v1, etc). If the user's configured URL needs probing, these commands will hit the wrong endpoint.\n\nThese paths predate the mustResolve() identity fix and were written before mustResolve() handled identity. Now that mustResolve() does the right thing, these should be refactored to use mustResolve() instead of duplicating client creation.\n\nFiles: cmd/aw/retire.go:50, cmd/aw/did.go:72\nRef: Code review finding on aw-9g9/aw-am0","status":"open","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-22T18:54:14Z","created_by":"Juan Reyero","updated_at":"2026-02-22T18:54:14Z"}
{"id":"aw-c32","title":"Add aw verify command","description":"New CLI command: aw verify. Calls POST /api/v1/verify-code with email+code. Resolves email from Account config via .aw/context. Prompts for 6-digit code interactively. Fires heartbeat after successful verification to confirm key works.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-19T13:05:59Z","created_by":"Juan Reyero","updated_at":"2026-02-19T13:28:44Z","closed_at":"2026-02-19T13:28:44Z","close_reason":"aw verify command implemented with config resolution, error parsing, code review fixes applied","dependencies":[{"issue_id":"aw-c32","depends_on_id":"aw-vin","type":"blocks","created_at":"2026-02-19T13:06:46Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-ckv","title":"Pass sent message timestamp as after in sendCommon SSE connect","description":"sendCommon opens SSE to wait for replies. Currently the SSE stream replays up to 50 historical messages and the acceptor skips past the sent message ID. This wastes bandwidth and latency.\n\nFix: Pass the sent message's timestamp as the 'after' parameter when opening the SSE stream. The server will only replay messages since the send (usually 0-1, catching the send→SSE race window). The sentMessageID skip logic in the acceptor can be simplified or removed since replayed messages before the send won't appear.\n\nDepends on: ChatStream after parameter being added.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-08T11:52:08Z","created_by":"Juan Reyero","updated_at":"2026-02-08T12:18:11Z","closed_at":"2026-02-08T12:18:11Z","close_reason":"Implemented in commit c40f1b8: ChatStream/NetworkChatStream accept after param, Send passes sentAt timestamp, Listen passes nil, skipped replay events filtered from result.Events","dependencies":[{"issue_id":"aw-ckv","depends_on_id":"aw-sb5","type":"blocks","created_at":"2026-02-18T16:59:14Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aw-cnn","title":"Add 'aw agents' CLI command","description":"ListAgents() client method exists but no CLI command exposes it. Add 'aw agents' command that calls GET /v1/agents and outputs agent list as JSON. Response includes agent_id, alias, human_name, agent_type, status, last_seen, online.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:06Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26Z","closed_at":"2026-02-04T11:33:26Z","close_reason":"Closed"}
{"id":"aw-drm","title":"Wire TOFU pin store into inbox/chat receive verification","description":"Verification currently only checks signature vs from_did (signing.go VerifyMessage). No TOFU pin store integration in inbox/chat receive paths — mail.go Inbox and chat.go ChatHistory just call VerifyMessage and stamp the status.\n\nSOT requires on receive:\n- First contact from a DID: create TOFU pin (from_did -\u003e public key) in local pin store\n- Subsequent contact: verify from_did matches pinned key\n- Lifetime-aware behavior: skip TOFU for ephemeral agents (lifetime=ephemeral)\n- Identity mismatch on pinned agent: attempt rotation_announcement validation before warning/quarantine\n\npinstore.go already exists with Pin struct (has StableID field). Need to:\n1. Call pin store during inbox/chat message verification\n2. Create pin on first verified contact\n3. Check pin on subsequent contacts\n4. Integrate lifetime from agent config (skip for ephemeral)\n5. Return IdentityMismatch status when pin doesn't match and no valid rotation\n\nFiles: mail.go (Inbox), chat.go (ChatHistory), network.go (NetworkChatHistory), chat/chat.go (parseSSEEvent), pinstore.go\nDepends on: aw-9g9, aw-am0\nRef: Tara's SOT audit finding #4","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-22T18:32:53Z","created_by":"Juan Reyero","updated_at":"2026-02-22T19:38:42Z","closed_at":"2026-02-22T19:38:42Z","close_reason":"Wired TOFU pin store into all receive paths (inbox, chat history, network chat history, SSE). Thread-safe with mutex. CLI loads from ~/.config/aw/pins.yaml.","dependencies":[{"issue_id":"aw-drm","depends_on_id":"aw-am0","type":"blocks","created_at":"2026-02-22T18:33:39Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-e0b","title":"Implement to_did recipient binding on send and receive","description":"Send paths don't populate ToDID at all. mail.go SendMessage signs To=alias and leaves ToDID empty. chat.go ChatCreateSession signs To as comma-joined alias list with no to_did. SOT requires to_did binding + receiver checks to prevent misroute.\n\nNeeded on send:\n- Resolve recipient DID before sending (via server directory / resolver)\n- Stamp ToDID (and optionally ToStableID) on the MessageEnvelope before signing\n- For mail: single recipient, straightforward\n- For chat: need to define canonical model for multi-recipient sessions. Options: (i) per-recipient envelope signing, or (ii) explicitly mark chat sessions as not having recipient-binding and document in SOT\n\nNeeded on receive:\n- Verify to_did matches receiver's own DID (current or known previous after rotation)\n- If mismatch, set VerificationStatus to IdentityMismatch (already defined in signing.go)\n\nFiles: mail.go, chat.go, network.go, dm.go, signing.go (VerifyMessage), cmd/aw/ send paths\nDepends on: aw-9g9, aw-am0\nRef: Tara's SOT audit finding #3","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-22T18:32:38Z","created_by":"Juan Reyero","updated_at":"2026-02-22T19:21:29Z","closed_at":"2026-02-22T19:21:29Z","close_reason":"Implemented to_did recipient binding: resolve via ServerResolver on send, stamp on wire, check on inbox receive. Chat paths skip binding per SOT.","dependencies":[{"issue_id":"aw-e0b","depends_on_id":"aw-am0","type":"blocks","created_at":"2026-02-22T18:33:35Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-e1p","title":"Add --debug flag for heartbeat and background error visibility","description":"fireHeartbeat() silently swallows all errors. Agents may appear offline with no feedback. Add a --debug flag or AW_DEBUG env var that logs background errors (heartbeat failures, config resolution issues) to stderr.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:15Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:13:40Z","closed_at":"2026-02-06T18:13:40Z","close_reason":"Standardized missing-flag errors and added --debug/AW_DEBUG for background error visibility"}
{"id":"aw-ejt","title":"RegisterResponse namespace field","description":"Add NamespaceSlug to RegisterResponse, Account, Selection, and store it when returned by server","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T11:54:15Z","created_by":"Juan Reyero","updated_at":"2026-02-21T11:57:34Z","closed_at":"2026-02-21T11:57:34Z","close_reason":"Added NamespaceSlug to RegisterResponse, Account, Selection, and config storage"}
{"id":"aw-fkp","title":"Use server-side timestamp for SSE after parameter to avoid clock skew","description":"The SSE after parameter currently uses a client-side sentAt timestamp. If client and server clocks differ, this could miss messages (client ahead) or over-replay (client behind). The proper fix is for the server to return created_at in the chat send response, so the client uses a server-authoritative timestamp. Not urgent for localhost deployment but needed for remote servers.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-08T12:27:17Z","created_by":"Juan Reyero","updated_at":"2026-02-08T12:29:26Z","closed_at":"2026-02-08T12:29:26Z","close_reason":"YAGNI - hypothetical problem for non-existent remote deployment"}
{"id":"aw-ga3","title":"Add post-verify heartbeat confirmation","description":"After successful aw verify, fire a heartbeat request to confirm the API key actually works. Print 'Verified\\! Your agent is now active.' on success. Surface error if heartbeat fails.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-19T13:06:14Z","created_by":"Juan Reyero","updated_at":"2026-02-19T13:51:06Z","closed_at":"2026-02-19T13:51:06Z","close_reason":"After successful aw verify, fires a heartbeat POST using the API key from config to confirm the agent is active. Prints 'Your agent is now active.' on success, or a warning on failure. Eliminated redundant config loading by capturing API key from existing resolution.","dependencies":[{"issue_id":"aw-ga3","depends_on_id":"aw-c32","type":"blocks","created_at":"2026-02-19T13:06:51Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-grj","title":"Add ReservationRevoke() client method and 'aw lock revoke' CLI command","description":"POST /v1/reservations/revoke endpoint has no Go client method. Add ReservationRevoke() to client library and 'aw lock revoke' CLI command. Request: {prefix (optional)}. Response: {revoked_count, revoked_keys}.","status":"closed","priority":3,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:09Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26Z","closed_at":"2026-02-04T11:33:26Z","close_reason":"Closed"}
{"id":"aw-gzh","title":"Add npm distribution channel for aw CLI","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-11T18:32:47Z","created_by":"Juan Reyero","updated_at":"2026-02-12T11:18:36Z","closed_at":"2026-02-12T11:18:36Z","close_reason":"npm distribution channel working: v0.11.0 published to npmjs.org, all 7 packages live, npx @awebai/aw version verified"}
{"id":"aw-h1u","title":"Add ClawDID cross-check for stable ID verification","description":"Data models already carry from_stable_id/to_stable_id (mail.go/chat.go/signing.go), and Pin has StableID field (pinstore.go), but CLI doesn't expose/configure stable IDs and ChainResolver's ClaWDID slot is unused.\n\nNeeded:\n- Implement a ClawDID resolver client\n- On receive when from_stable_id is present: verify via ClaWDID GET /did/{did_claw}/key\n- Check log_head evidence: verify signature + entry_hash + cache monotonicity\n- Cross-check that the did:key in the message matches the current key in the ClaWDID log\n\nReference: docs/aw-clawdid-key-verification.md (in clawdid repo), ClaWDID GET /did/{did_claw}/key returns log_head evidence (seq/op/entry_hash/state_hash/authorized_by/timestamp/signature).\n\nNOTE: This depends on ClawDID being available and may be deferred if ClawDID integration is not yet ready. Tara flagged spec alignment items still needed: did method name (did:claw vs did:aw), raw public key encoding (base64 vs base64url), signing canonicalization for /full auth string.\n\nFiles: new clawdid_resolver.go (or extend existing resolver), pinstore.go\nDepends on: aw-tkc (rotation announcements), clawdid service availability\nRef: Tara's SOT audit finding #6","status":"open","priority":3,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-22T18:33:22Z","created_by":"Juan Reyero","updated_at":"2026-02-22T18:33:22Z","dependencies":[{"issue_id":"aw-h1u","depends_on_id":"aw-tkc","type":"blocks","created_at":"2026-02-22T18:33:48Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-iam","title":"Add message_id to signed payload and dedup on verify","description":"Per Tara's review: ClaWDID SOT now includes message_id (UUID4) in signed fields. Need to: (1) add MessageID string to MessageEnvelope, (2) include message_id in canonicalJSON, (3) add dedup window on verify to prevent replay attacks. Blocked until message_id format/generation is finalized in aweb server.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-22T12:40:37Z","created_by":"Juan Reyero","updated_at":"2026-02-22T15:10:57Z","closed_at":"2026-02-22T15:10:57Z","close_reason":"message_id added to signed payload, all send/verify paths covered, code reviewed"}
{"id":"aw-ieg","title":"Add contacts management and access-mode to aw CLI","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-08T14:26:20Z","created_by":"Juan Reyero","updated_at":"2026-02-08T14:31:40Z","closed_at":"2026-02-08T14:31:40Z","close_reason":"Contacts CRUD + agent access-mode CLI commands implemented with full test coverage"}
{"id":"aw-j80","title":"Design: explicit send-and-wait / send-and-leave chat protocol","description":"## Problem\n\nAgents coordinating via chat get trapped in 120-second waits. The most common failure: an agent replies to a waiting sender but forgets --leave-conversation, blocking for 120s waiting for a counter-reply that never comes.\n\nThe deeper issue: the protocol doesn't propagate wait state. When you receive a message, you don't know if the sender is sitting there waiting for your response. And when you reply, the default behavior (wait 120s) assumes you're starting a new exchange, not answering one.\n\n## Correct Protocol\n\nThe rule is simple: **always wait after sending, unless the other party left in the previous round.**\n\n### Flow\n\n1. A sends and waits (--start-conversation, 5 min)\n2. B sees the message, sends reply and waits (default 120s)\n3. A gets B's reply. A knows B is waiting (sender_waiting=true in the SSE event). A thinks, writes back, and leaves (--leave-conversation).\n4. B receives A's reply plus the info that A is not waiting (sender_leaving=true). B either replies-and-leaves, or just stops.\n\nThe agent that ends the conversation MUST make it explicit. Otherwise the other agent will, by default, reply and wait — and get trapped.\n\n## What's Missing\n\n### 1. Receiving agent doesn't know if sender is waiting\n\nWhen B receives a message via SSE, the event doesn't include sender_waiting. B can't tell if A is sitting there expecting a reply or if A fired-and-forgot. This should be appended to every message event so the receiving agent always knows.\n\n### 2. Leaving can't be signaled via ChatSendMessage\n\nCurrently leaving can only be signaled via ChatCreateSession (alias-based). ChatSendMessage (session-ID-based) has no Leaving field, so there's no way to leave via the session-ID path. This is inconsistent with HangOn which works on both.\n\n### 3. Default behavior is ambiguous\n\nThe current flags are:\n- --start-conversation: wait 5 min\n- --leave-conversation: send and exit\n- (default): wait 120s\n\nThe problem is the default. \"wait 120s\" is correct for continuing a conversation but wrong for a final reply. Agents must remember to add --leave-conversation, and they forget.\n\nConsider making the intent more explicit, e.g.:\n- send-and-wait: \"I expect a reply, wait for it\"\n- send-and-leave: \"I'm done, don't wait\"\n\nThis removes the ambiguous default and forces every send to declare intent.\n\n## Implementation Phases\n\n### Phase A: Wire protocol gaps (client-only, backward compatible)\n\n1. Add Leaving field to ChatSendMessageRequest and NetworkChatSendMessageRequest (omitempty, server ignores unknown fields)\n2. Add SenderWaiting field to Event struct, parse sender_waiting from SSE events\n3. Add SenderWaiting to ChatSessionItem for when server starts including it\n\n### Phase B: Server-side sender_waiting propagation\n\nWhen B sends a message while waiting on SSE, the message event delivered to A should include sender_waiting: true. This lets A know B expects a reply. Server needs to:\n- Include sender_waiting in SSE message events\n- Include sender_waiting in ChatSessionItem (list sessions response)\n\n### Phase C: UX — make wait intent explicit\n\nEvaluate whether to replace the ambiguous default with explicit send-and-wait / send-and-leave semantics. This is a UX decision that affects how bdh :aweb chat commands work.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T22:51:54Z","created_by":"Juan Reyero","updated_at":"2026-02-07T22:54:50Z","closed_at":"2026-02-07T22:54:50Z","close_reason":"Phase A wire protocol gaps implemented: Leaving on ChatSendMessage, SenderWaiting on SSE events, propagation to SendResult. Phases B (server) and C (UX) remain as future work."}
{"id":"aw-ktk","title":"Update usage() help text with new commands","description":"After adding agents, mail ack, lock renew, project, and lock revoke commands, update the usage() function in main.go to include them all.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:15Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26Z","closed_at":"2026-02-04T11:33:26Z","close_reason":"Closed"}
{"id":"aw-lmj","title":"Fix SSE goroutine leak in chat Send()","description":"In chat/chat.go Send(), streamToChannel() goroutine may leak if context cancels while it's reading from the SSE stream. defer stream.Close() may close the stream while the goroutine is still reading. Need explicit synchronization or errgroup to ensure clean shutdown.","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:04Z","created_by":"Juan Reyero","updated_at":"2026-02-06T16:31:44Z","closed_at":"2026-02-06T16:31:44Z","close_reason":"Fixed goroutine leak in streamToChannel: returns cleanup func that closes stream, cancels goroutine, waits for exit. Channel sends use select to avoid blocking on full buffer."}
{"id":"aw-mq5","title":"Fix duplicate hang_on callback firing in sendCommon and Listen","description":"In both sendCommon and Listen, when a hang_on event arrives, the callback fires twice with confusingly different messages:\n\nWhen ExtendsWaitSeconds \u003e 0:\n  1. callback('hang_on', 'bob: thinking...')          — the body\n  2. callback('wait_extended', 'wait extended by 5 min (bob requested more time)')  — from extendWait\n\nWhen ExtendsWaitSeconds == 0:\n  1. callback('hang_on', 'bob: thinking...')          — the body\n  2. callback('hang_on', 'bob requested more time')   — from the else-if branch\n\nThe second callback in the ExtendsWaitSeconds==0 case is redundant — the first callback already conveyed the hang_on with the body.\n\nFix: Remove the else-if branch (lines 399-401 in sendCommon, equivalent in Listen). The first callback('hang_on', body) is sufficient. The wait_extended callback from extendWait is useful and should stay.\n\nFiles: chat/chat.go (two locations — but should become one after issue 1 is fixed)","status":"closed","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:25:02Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:38:58Z","closed_at":"2026-02-08T09:38:58Z","close_reason":"Removed redundant else-if branch. Added TestHangOnWithoutExtensionFiresOneCallback. All 37 tests pass.","dependencies":[{"issue_id":"aw-mq5","depends_on_id":"aw-w7a","type":"blocks","created_at":"2026-02-18T16:59:14Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aw-mwx","title":"Split main.go into per-command files","description":"cmd/aw/main.go is 1000+ lines with all CLI command handlers. Split into separate files by command group (e.g. mail.go, chat.go, lock.go, agents.go) for maintainability. Keep main() and usage() in main.go.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:13Z","created_by":"Juan Reyero","updated_at":"2026-02-04T17:04:37Z","closed_at":"2026-02-04T17:04:37Z","close_reason":"Split main.go into per-command files as part of cobra migration"}
{"id":"aw-n5m","title":"Chat operations (Listen/Open/History/HangOn/ShowPending) fail for network addresses","description":"All chat operations except Send go through findSession(), which only queries OSS endpoints (/v1/chat/pending, /v1/chat/sessions). Network conversations live at /api/v1/network/chat/... endpoints.\n\nImpact: 'aw chat listen acme/bot', 'aw chat open acme/bot', 'aw chat history acme/bot', 'aw chat hang-on acme/bot msg', and 'aw chat show-pending acme/bot' all fail with 'no conversation found'.\n\nOnly chatSend in cmd/aw/chat.go:24-31 correctly routes between OSS and network paths. All other operations need equivalent routing.\n\nFix approach:\n1. findSession needs a network-aware variant (or a flag/separate function) that queries NetworkChatPending and network session list endpoints\n2. Listen needs a network variant (like SendNetwork is to Send) that uses client.NetworkChatStream instead of client.ChatStream\n3. Open, History, HangOn, ShowPending need network routing at the cmd/aw/chat.go level (like chatSend does with ParseNetworkAddress)\n4. The underlying network client methods for pending/history/mark-read already exist in network.go\n\nFiles: chat/chat.go, cmd/aw/chat.go, network.go","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:24:56Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:59:15Z","closed_at":"2026-02-08T09:59:15Z","close_reason":"All chat operations now route through network endpoints for org/alias addresses. Added NetworkChatHistory client method, findNetworkSession, 5 network variant protocol functions, and routing helpers at cmd level. All 42 tests pass."}
{"id":"aw-nv6","title":"Make worktree context file writes atomic","description":"awconfig/context.go SaveWorktreeContextTo() uses os.WriteFile directly, unlike global config which uses temp-file-and-rename. Process kill during write could corrupt the context file. Should use the same atomic write pattern as global_config.go.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:08Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:02:05Z","closed_at":"2026-02-06T18:02:05Z","close_reason":"Extracted atomicWriteFile() helper with chmod-before-write pattern. Both SaveGlobalTo and SaveWorktreeContextTo now use it."}
{"id":"aw-ol8","title":"aw agent privacy command","description":"Add privacy field to AgentView/PatchAgentRequest/PatchAgentResponse with omitempty on access_mode. New agent privacy subcommand.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-21T11:54:19Z","created_by":"Juan Reyero","updated_at":"2026-02-21T11:59:40Z","closed_at":"2026-02-21T11:59:40Z","close_reason":"Added agent privacy command with GET/SET, omitempty on access_mode"}
{"id":"aw-oo0","title":"Fix config temp file permissions window","description":"In awconfig/global_config.go, os.CreateTemp uses default umask before API key data is written. There's a brief window where the temp file may have overly permissive mode. Should explicitly chmod the temp file before writing sensitive data, or use os.OpenFile with restrictive mode.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:06Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:02:05Z","closed_at":"2026-02-06T18:02:05Z","close_reason":"Extracted atomicWriteFile() helper with chmod-before-write pattern. Both SaveGlobalTo and SaveWorktreeContextTo now use it."}
{"id":"aw-p1b","title":"Refactor chat CLI: positional args and rename --leaving","description":"Per alignment with Alice (bdh-2et): (1) Change chat subcommands to use positional args for required params (alias, message) instead of flags. (2) Rename --leaving to --leave-conversation on chat send. (3) Update usage() text. (4) Update tests. Affects: runChatSend, runChatOpen, runChatHistory, runChatHangOn, runChatShowPending.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T13:06:15Z","created_by":"Juan Reyero","updated_at":"2026-02-04T13:09:44Z","closed_at":"2026-02-04T13:09:44Z","close_reason":"All 5 chat subcommands refactored to positional args, --leaving renamed to --leave-conversation, usage text updated, tests pass."}
{"id":"aw-p8u","title":"Implement 'aw register' CLI command","description":"Add 'aw register --server \u003curl\u003e --email \u003cemail\u003e [--username \u003cname\u003e] [--alias \u003calias\u003e] [--human-name \u003cname\u003e]' command.\n\nCalls POST /v1/auth/register on the server, saves returned aw_sk_* as standard Account entry in config.yaml.\n\nProtocol contract:\n  Request:  { email, username?, password?, alias?, human_name? }\n  Response: { api_key, agent_id, alias, username, project_slug, project_name, server_url, verification_required }\n\nError handling: 404 (server doesn't support registration), 409 (email/username taken), 422 (missing field — prompt interactively for password if server requires it), 429 (rate limited).\n\nOn success print: 'Account created for \u003cusername\u003e. Agent \u003cusername\u003e/\u003calias\u003e is live. Verification email sent — verify within 24h.'\n\nBlocked by claweb-dfm (server-side endpoint, filed by eve). Can develop + unit test against mocked responses in parallel.\n\nDesign discussion: chat with eve 2026-02-09.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-09T14:07:03Z","created_by":"Juan Reyero","updated_at":"2026-02-09T14:20:03Z","closed_at":"2026-02-09T14:20:03Z","close_reason":"Implemented on feat/aw-register branch. register.go (types+client), cmd/aw/register.go (cobra command), 5 integration tests all passing. Blocked by server-side endpoint (claweb-dfm) for live use."}
{"id":"aw-q3q","title":"TestSendStartConversationUpgradesWhenNotExplicit doesn't verify the upgrade","description":"The test sets a 2s context timeout and Wait=DefaultWait (120s). It expects context.DeadlineExceeded to prove the wait was upgraded to 300s. But the test would produce the identical result without the upgrade — the context (2s) is shorter than DefaultWait (120s), so it would always hit DeadlineExceeded regardless.\n\nThe test proves nothing beyond 'Send waits at all', which is already tested by TestSendWithTimeout.\n\nFix: The test needs to actually observe the difference between 120s and 300s wait. Options:\n- Mock the timer or inject a clock to verify the configured timeout\n- Use a short Wait value (e.g., 1s) so the test can distinguish between 'waited 1s' (no upgrade) and 'waited longer' (upgraded to 300s)\n- Capture the wait timer value through the callback or result\n\nFiles: chat/chat_test.go (TestSendStartConversationUpgradesWhenNotExplicit)","status":"closed","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:25:10Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:42:26Z","closed_at":"2026-02-08T09:42:26Z","close_reason":"Rewrote test to use Wait=1 so it can distinguish upgraded (300s) from non-upgraded (1s) wait. All tests pass."}
{"id":"aw-q93","title":"Make aw init --cloud work with aw_sk_ API keys","description":"Adjust resolveCloudToken in init.go to fall back to existing aw_sk_ key from config when no JWT/cloud token available. Require --alias when using aw_sk_ auth. New agent goes into same project as existing key. Server-side: Frank is making POST /api/v1/agents/bootstrap accept aw_sk_ auth.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-19T13:06:21Z","created_by":"Juan Reyero","updated_at":"2026-02-19T14:00:00Z","closed_at":"2026-02-19T14:00:00Z","close_reason":"resolveCloudToken now falls back to aw_sk_ keys from config/env when no JWT available. Early check in runInit requires --alias when using aw_sk_ auth. Updated flag help text to document the full token resolution priority."}
{"id":"aw-rmv","title":"[EPIC] aw identity system: per-agent Ed25519 keypairs, did:key, message signing/verification","description":"Implement the identity layer for the aw CLI and Go library as specified in sot.md. Each agent gets its own Ed25519 keypair and did:key. Messages are signed. Signatures are verified offline. Persistent agents get TOFU pinning; ephemeral agents (BeadHub) skip it. Architecture reference: ../clawdid/sot.md (V3). Implementation spec: sot.md. Contract with bdh (Charlie): bdh passes custody=custodial, lifetime=ephemeral in Init; stores returned DID; reads VerificationStatus on incoming messages; calls Deregister on cleanup. Zero crypto code in bdh.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:50:51Z","created_by":"Juan Reyero","updated_at":"2026-02-22T14:42:36Z","closed_at":"2026-02-22T14:42:36Z","close_reason":"All 16 sub-beads complete: didkey, signing, pinstore, identity resolvers, config fields, register/init identity, deregister, client identity, message signing (7 paths), message verification (inbox/history/network/SSE), key rotation + custodial graduation, did log, agent retirement, introspect identity fields."}
{"id":"aw-rmv.1","title":"Implement didkey.go: ComputeDIDKey and ExtractPublicKey","description":"New file didkey.go in root package. ComputeDIDKey(pub ed25519.PublicKey) string: prepend 0xed01 multicodec, base58btc encode, prepend did:key:z. ExtractPublicKey(did string) (ed25519.PublicKey, error): reverse. Unit tests against known test vectors from W3C did:key spec. See sot.md §4.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:51:19Z","created_by":"Juan Reyero","updated_at":"2026-02-22T12:11:38Z","closed_at":"2026-02-22T12:11:38Z","close_reason":"Implemented ComputeDIDKey and ExtractPublicKey with W3C test vectors. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.1","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:51:19Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.10","title":"Add signingKey/did to Client, NewWithIdentity constructor, put helper","description":"Modify client.go: add signingKey ed25519.PrivateKey and did string fields to Client struct. New constructor NewWithIdentity(baseURL, apiKey string, signingKey ed25519.PrivateKey, did string) (*Client, error). Existing constructors New() and NewWithAPIKey() unchanged — they leave signingKey nil (legacy/custodial mode). Add put() helper method alongside existing get/post/patch/delete for rotation and retirement endpoints. Unit test: NewWithIdentity sets fields, NewWithAPIKey leaves them nil. See sot.md §6.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:52:15Z","created_by":"Juan Reyero","updated_at":"2026-02-22T12:39:18Z","closed_at":"2026-02-22T12:39:18Z","close_reason":"Added signingKey/did to Client, NewWithIdentity with DID validation, SigningKey()/DID() accessors, put() helper. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.10","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:52:14Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.10","depends_on_id":"aw-rmv.2","type":"blocks","created_at":"2026-02-21T21:53:38Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.11","title":"Sign outgoing messages in all send paths","description":"When Client.signingKey is non-nil, sign outgoing messages before transmission. Paths to modify: SendMessage (mail.go), NetworkSendMail (network.go), SendDM (dm.go), ChatCreateSession (chat.go), ChatSendMessage (chat.go). For each: build envelope with from, from_did, to, to_did, type, subject, body, timestamp. Call SignMessage. Attach signature and signing_key_id to request body. When signingKey is nil (custodial/legacy), send without signatures — server signs for custodial. Integration tests: mock server verifies received signature fields. See sot.md §6.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:52:19Z","created_by":"Juan Reyero","updated_at":"2026-02-22T13:32:42Z","closed_at":"2026-02-22T13:32:42Z","close_reason":"Signed outgoing messages in all 7 send paths. signEnvelope helper on Client. Tests cover all paths including ToAgentID fallback and crypto verification.","dependencies":[{"issue_id":"aw-rmv.11","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:52:19Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.11","depends_on_id":"aw-rmv.10","type":"blocks","created_at":"2026-02-21T21:53:46Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.12","title":"Verify incoming messages and populate VerificationStatus","description":"Add VerificationStatus field to InboxMessage and ChatMessage structs. On receive, call VerifyMessage on each message to populate the field. Paths: Inbox() in mail.go, ChatStream SSE events in chat.go, ChatHistory() in chat.go. ChatPending() defers verification to message open. Messages are always delivered regardless of status — caller decides what to do. For TOFU: call PinStore.CheckPin with lifetime from resolution metadata. For rotation announcements: check rotation_announcement field, verify old-key signature, auto-accept if valid. Integration tests: verified message, unverified (no DID), failed (bad sig), identity mismatch, ephemeral agent skips pin. See sot.md §7.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:52:25Z","created_by":"Juan Reyero","updated_at":"2026-02-22T13:45:44Z","closed_at":"2026-02-22T13:45:44Z","close_reason":"Verified incoming messages in Inbox(), ChatHistory(), NetworkChatHistory(). Added identity fields to InboxMessage/ChatMessage. Added address to Client for signed envelopes. Created aw-1zx for SSE stream verification gap.","dependencies":[{"issue_id":"aw-rmv.12","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:52:25Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.12","depends_on_id":"aw-rmv.2","type":"blocks","created_at":"2026-02-21T21:53:50Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.12","depends_on_id":"aw-rmv.3","type":"blocks","created_at":"2026-02-21T21:53:55Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.13","title":"Implement aw did rotate-key and aw did rotate-key --self-custody","description":"New file cmd/aw/did.go. aw did rotate-key: generate new keypair locally, compute new did:key, PUT /api/agents/{old-did}/rotate with new_did, new_public_key, custody, rotation_signature (old key signs canonical JSON of rotation payload). Archive old key. Update config. aw did rotate-key --self-custody: same but for custodial-to-self transition — server signs rotation on behalf, then destroys old key. Generate rotation announcement for attachment to subsequent messages. Integration tests: mock server receives rotation request, verify signature, verify config updated. See sot.md §9.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:52:37Z","created_by":"Juan Reyero","updated_at":"2026-02-22T13:57:39Z","closed_at":"2026-02-22T13:57:39Z","close_reason":"Library (rotate.go) + CLI (cmd/aw/did.go) + tests. Code reviewed and fixes applied.","dependencies":[{"issue_id":"aw-rmv.13","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:52:37Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.13","depends_on_id":"aw-rmv.10","type":"blocks","created_at":"2026-02-21T21:53:59Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.13","depends_on_id":"aw-rmv.5","type":"blocks","created_at":"2026-02-21T21:54:08Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.14","title":"Implement aw did log command","description":"Add to cmd/aw/did.go: aw did log [address-or-did]. GET /api/agents/{did}/log. Display rotation and status history entries. Each entry shows operation, old/new DID, timestamp, signed_by. Integration test: mock server returns log entries. See sot.md §12 (agent log endpoint).","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:52:43Z","created_by":"Juan Reyero","updated_at":"2026-02-22T14:05:24Z","closed_at":"2026-02-22T14:05:24Z","close_reason":"Library (agent_log.go) + CLI (did.go didLogCmd) + tests. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.14","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:52:42Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.14","depends_on_id":"aw-rmv.4","type":"blocks","created_at":"2026-02-21T21:54:12Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.15","title":"Implement aw agent retire --successor","description":"New file cmd/aw/retire.go. aw agent retire --successor \u003caddress\u003e. PUT /api/agents/{did}/retire with status=retired, successor_did, successor_address. Request signed by old agent key. On receiving retired agent messages: show successor info, prompt operator to accept (do NOT auto-follow). Integration test: mock server receives retirement request with signature. See sot.md §10.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:52:48Z","created_by":"Juan Reyero","updated_at":"2026-02-22T14:13:02Z","closed_at":"2026-02-22T14:13:02Z","close_reason":"Library (retire.go) + CLI (cmd/aw/retire.go) + tests. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.15","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:52:47Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.15","depends_on_id":"aw-rmv.10","type":"blocks","created_at":"2026-02-21T21:54:17Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.16","title":"Add DID, custody, lifetime, public_key to aw introspect output","description":"Modify cmd/aw/introspect.go (or wherever introspect is implemented): add did, custody, lifetime, public_key lines to output. For persistent self-custodial: show all fields. For custodial: show did, custody=custodial. For ephemeral: show did, custody=custodial, lifetime=ephemeral. Load from awconfig Account fields. Integration test: verify output includes new fields. See sot.md §11.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:52:52Z","created_by":"Juan Reyero","updated_at":"2026-02-22T14:34:32Z","closed_at":"2026-02-22T14:34:32Z","close_reason":"Added DID, custody, lifetime to introspect output via embedded struct. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.16","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:52:52Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.16","depends_on_id":"aw-rmv.6","type":"blocks","created_at":"2026-02-21T21:54:21Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.2","title":"Implement signing.go: canonical JSON, SignMessage, VerifyMessage, VerificationStatus","description":"New file signing.go in root package. VerificationStatus type (verified, verified_custodial, unverified, failed, identity_mismatch). SignMessage(key, envelope) (string, error): build canonical JSON of signed fields (from, from_did, to, to_did, type, subject, body, timestamp — note from/to ARE signed per architecture doc V3), ed25519.Sign, base64 no-padding. VerifyMessage(envelope) (VerificationStatus, error): extract pubkey from from_did via ExtractPublicKey, reconstruct canonical payload, verify. Unit tests: round-trip sign/verify, tampered body fails, missing DID returns unverified, bad signature returns failed. Depends on didkey.go. See sot.md §6-7.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:51:24Z","created_by":"Juan Reyero","updated_at":"2026-02-22T12:30:37Z","closed_at":"2026-02-22T12:30:37Z","close_reason":"Implemented VerificationStatus, MessageEnvelope, canonicalJSON, SignMessage, VerifyMessage. Code reviewed - fixed sort brittleness, SigningKeyID validation, error propagation.","dependencies":[{"issue_id":"aw-rmv.2","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:51:24Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.2","depends_on_id":"aw-rmv.1","type":"blocks","created_at":"2026-02-21T21:53:02Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.3","title":"Implement pinstore.go: TOFU pin storage, lifetime-aware","description":"New file pinstore.go in root package. PinStore: load/save ~/.config/aw/known_agents.yaml. CheckPin(address, did, lifetime string) PinResult: if ephemeral skip pin check, if no pin store new, if pin matches OK, if pin differs IDENTITY_MISMATCH. StorePin(did, address, handle, server). Unit tests: store and check roundtrip, mismatch detection, ephemeral agents skip pinning. See sot.md §3 (known_agents.yaml format), §7 (verification step 7-8).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:51:29Z","created_by":"Juan Reyero","updated_at":"2026-02-22T12:47:41Z","closed_at":"2026-02-22T12:47:41Z","close_reason":"PinStore with CheckPin, StorePin, Save/Load. Lifetime constants, atomic save with cleanup, address-change reverse index fix. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.3","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:51:28Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.4","title":"Implement identity.go: AgentIdentity, IdentityResolver, DIDKeyResolver, ChainResolver","description":"New file identity.go in root package. AgentIdentity struct with DID, Address, Handle, PublicKey, ServerURL, Custody, Lifetime, ResolvedAt, ResolvedVia. IdentityResolver interface: Resolve(ctx, identifier) (*AgentIdentity, error). DIDKeyResolver: extracts pubkey from did:key, no network. ServerResolver: GET /api/agents/resolve/{namespace/alias}. PinResolver: lookup from known_agents.yaml. ChainResolver: dispatches by identifier format (did:key: prefix vs namespace/alias), cross-checks server-reported pubkey against DID. Nil-safe ClaWDID slot for Phase 2. Unit tests for each resolver. See sot.md §8.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:51:33Z","created_by":"Juan Reyero","updated_at":"2026-02-22T13:20:15Z","closed_at":"2026-02-22T13:20:15Z","close_reason":"Implemented identity.go: AgentIdentity, IdentityResolver, DIDKeyResolver, ServerResolver, PinResolver, ChainResolver. Code review fixes applied.","dependencies":[{"issue_id":"aw-rmv.4","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:51:33Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.4","depends_on_id":"aw-rmv.1","type":"blocks","created_at":"2026-02-21T21:53:07Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.5","title":"Implement awconfig/keys.go: keypair generation and per-agent file storage","description":"New file awconfig/keys.go. GenerateKeypair() (ed25519.PublicKey, ed25519.PrivateKey, error). SaveKeypair(address, privKey, pubKey) error: writes to ~/.config/aw/keys/\u003caddress-with-dashes\u003e.signing.key and .pub with 0600 permissions. LoadSigningKey(path string) (ed25519.PrivateKey, error). ArchiveKey(oldDID, privKey, pubKey) error: moves to rotated/\u003cold-did-with-dashes\u003e.key. Key backup warning at generation time. Unit tests: generate, save, load roundtrip, permissions check. See sot.md §3.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:51:45Z","created_by":"Juan Reyero","updated_at":"2026-02-22T12:18:12Z","closed_at":"2026-02-22T12:18:12Z","close_reason":"Implemented GenerateKeypair, SaveKeypair, LoadSigningKey, LoadPublicKey, ArchiveKey. Code reviewed - fixed pub key perms, param order, PEM error tests.","dependencies":[{"issue_id":"aw-rmv.5","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:51:45Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.6","title":"Add DID, SigningKey, Custody, Lifetime fields to awconfig.Account","description":"Modify awconfig/global_config.go: add DID string yaml:did,omitempty, SigningKey string yaml:signing_key,omitempty, Custody string yaml:custody,omitempty, Lifetime string yaml:lifetime,omitempty to Account struct. Add top-level Handle string yaml:handle,omitempty to GlobalConfig. Propagate to awconfig/selection.go (Selection struct, finalizeSelection). Tests for YAML serialization roundtrip including new fields. Backward compatible: empty fields = legacy mode. See sot.md §3.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:51:50Z","created_by":"Juan Reyero","updated_at":"2026-02-22T12:22:57Z","closed_at":"2026-02-22T12:22:57Z","close_reason":"Added DID, SigningKey, Custody, Lifetime to Account and Selection. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.6","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:51:49Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.7","title":"Add identity fields to RegisterRequest/RegisterResponse","description":"Modify register.go: add DID, PublicKey, Custody, Lifetime to RegisterRequest (all omitempty). Add DID, Custody, Lifetime to RegisterResponse. Modify cmd/aw/register.go: generate keypair (via awconfig/keys.go), compute did:key, send in registration request. Store DID, signing_key path, custody, lifetime in awconfig Account. Integration test: mock server receives DID/public_key/custody/lifetime, returns DID. See sot.md §5.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:51:54Z","created_by":"Juan Reyero","updated_at":"2026-02-22T12:58:06Z","closed_at":"2026-02-22T12:58:06Z","close_reason":"Added DID/PublicKey/Custody/Lifetime to RegisterRequest/Response. CLI generates keypair, sends identity, saves keys after config update. Added constants, helpers. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.7","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:51:54Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.7","depends_on_id":"aw-rmv.1","type":"blocks","created_at":"2026-02-21T21:53:11Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.7","depends_on_id":"aw-rmv.5","type":"blocks","created_at":"2026-02-21T21:53:16Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.7","depends_on_id":"aw-rmv.6","type":"blocks","created_at":"2026-02-21T21:53:24Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.8","title":"Add identity fields to InitRequest/CloudBootstrapAgentRequest","description":"Modify init.go: add DID, PublicKey, Custody, Lifetime to InitRequest. Modify cloud_bootstrap.go: add same to CloudBootstrapAgentRequest. Modify cmd/aw/init.go: for self-custodial, generate keypair and send DID fields. For custodial (bdh path), just pass Custody/Lifetime — server generates key and returns DID. Store returned DID in awconfig Account. Integration test: mock server returns DID in InitResponse, verify stored in config. This is the bdh contract entry point. See sot.md §5.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:51:59Z","created_by":"Juan Reyero","updated_at":"2026-02-22T13:07:05Z","closed_at":"2026-02-22T13:07:05Z","close_reason":"Added identity fields to Init/CloudBootstrap request/response. CLI generates keypair for both init paths, propagates through cloud bootstrap adapter. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.8","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:51:59Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.8","depends_on_id":"aw-rmv.1","type":"blocks","created_at":"2026-02-21T21:53:33Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aw-rmv.8","depends_on_id":"aw-rmv.6","type":"blocks","created_at":"2026-02-21T21:53:28Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-rmv.9","title":"Implement deregister.go: Deregister client method for ephemeral agents","description":"Implement deregister.go with two methods: Deregister(ctx) for self-deregistration (DELETE /v1/agents/me, used by bdh) and DeregisterAgent(ctx, namespace, alias) for peer deregistration (DELETE /v1/agents/{namespace}/{alias}, used by project admins). Bearer token identifies the caller. Integration test with mock server.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:52:10Z","created_by":"Juan Reyero","updated_at":"2026-02-22T13:12:24Z","closed_at":"2026-02-22T13:12:24Z","close_reason":"Deregister (self) and DeregisterAgent (peer) with URL path escaping. Code reviewed.","dependencies":[{"issue_id":"aw-rmv.9","depends_on_id":"aw-rmv","type":"parent-child","created_at":"2026-02-21T21:52:10Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-sb5","title":"Add after parameter to ChatStream and NetworkChatStream","description":"The SSE stream endpoint replays up to 50 historical messages on every connect. Grace is adding an optional 'after' query param (ISO timestamp) to the aweb server so clients can control replay. Client changes needed:\n\n1. ChatStream signature gains an 'after *time.Time' parameter\n2. NetworkChatStream gains the same parameter\n3. streamOpener type signature updated to include after\n4. When after is provided, append '\u0026after=\u003ciso-timestamp\u003e' to the stream URL\n5. When after is nil, no replay (server polls from now())\n\nBlocked on: Grace shipping the after param in aweb (she confirmed she's implementing it).","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-08T11:52:00Z","created_by":"Juan Reyero","updated_at":"2026-02-08T12:18:11Z","closed_at":"2026-02-08T12:18:11Z","close_reason":"Implemented in commit c40f1b8: ChatStream/NetworkChatStream accept after param, Send passes sentAt timestamp, Listen passes nil, skipped replay events filtered from result.Events"}
{"id":"aw-sw6","title":"Add GetCurrentProject() client method and 'aw project' CLI command","description":"GET /v1/projects/current endpoint has no Go client method. Add GetCurrentProject() to client library and 'aw project' CLI command. Response: {project_id, slug, name}.","status":"closed","priority":3,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:08Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26Z","closed_at":"2026-02-04T11:33:26Z","close_reason":"Closed"}
{"id":"aw-tkc","title":"Implement rotation announcement parsing and verification","description":"No rotation_announcement handling exists in the codebase (rg rotation_announcement finds only sot.md references). SOT §5.4 adds rotation_announcements (plural) for multi-hop rotation chains.\n\nWhen a TOFU pin mismatch is detected:\n1. Check if the message carries a rotation_announcement\n2. Validate the rotation chain: old key signed the rotation to new key\n3. For multi-hop chains: validate each link in the chain\n4. If valid: update the TOFU pin to the new key\n5. If invalid: quarantine/warn (IdentityMismatch status)\n\nAlso need to handle the case where multiple rotations happen before a peer sees the first one (the multi-hop chain prevents TOFU break in this scenario).\n\nConformance vector: clawdid/vectors/rotation-announcements-v1.json\n\nFiles: new rotation_announcement.go (or extend signing.go), pinstore.go (pin update on valid rotation)\nDepends on: aw-drm (TOFU pins must exist before rotation can update them)\nRef: Tara's SOT audit finding #5, SOT §5.4","status":"open","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-22T18:33:06Z","created_by":"Juan Reyero","updated_at":"2026-02-22T18:33:06Z","dependencies":[{"issue_id":"aw-tkc","depends_on_id":"aw-drm","type":"blocks","created_at":"2026-02-22T18:33:43Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aw-u23","title":"Fix aw chat pending to include network chats","description":"aw chat pending only calls /v1/chat/pending (local), never /v1/network/chat/pending. Cross-org network chats are invisible to agents polling with aw chat pending.","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-19T21:51:14Z","created_by":"Juan Reyero","updated_at":"2026-02-19T21:51:28Z","closed_at":"2026-02-19T21:51:28Z","close_reason":"Pending now calls both ChatPending and NetworkChatPending, merges results. Context cancellation propagated, other network errors gracefully skipped."}
{"id":"aw-vin","title":"Add Email field to Account config and RegisterResponse","description":"Add Email string field to awconfig.Account struct (yaml:email). Add Email field to aweb.RegisterResponse. Store email from register response in config for use by aw verify.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-19T13:05:45Z","created_by":"Juan Reyero","updated_at":"2026-02-19T13:17:51Z","closed_at":"2026-02-19T13:17:51Z","close_reason":"Email field added to Account, Selection, and RegisterResponse with tests"}
{"id":"aw-w7a","title":"Extract shared wait loop from sendCommon and Listen to eliminate duplication","description":"Listen() in chat/chat.go:422-537 is a ~115-line copy-paste of the wait loop from sendCommon() (chat/chat.go:233-419). The extendWait closure is 100% identical. The event processing loop is nearly identical, differing only in: (1) no seenSentMessage replay-skip logic, (2) no target-filtering (returns on any message), (3) no SenderWaiting propagation.\n\nFix: Extract a shared waitForReply/waitForEvent function that accepts the differences as parameters — e.g., a message filter function, whether to skip replays, the sent message ID. Both sendCommon and Listen should call this shared function.\n\nFiles: chat/chat.go\nScope: ~115 lines of duplicated code → single shared implementation","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:24:46Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:37:30Z","closed_at":"2026-02-08T09:37:30Z","close_reason":"Extracted waitForMessage function, Listen reduced from ~115 to ~15 lines. All 36 tests pass."}
{"id":"aw-xab","title":"Stop accumulating replayed SSE events in result.Events","description":"waitForMessage line 305 does result.Events = append(result.Events, chatEvent) for every SSE event including replayed historical messages. On a 35-message conversation, send-and-wait returned all 35 historical messages in the JSON response events array. This is a memory and bandwidth problem that grows with conversation size.\n\nFix: After the server-side 'after' parameter eliminates most replay, this largely goes away. But as defense in depth, consider filtering result.Events to exclude events the acceptor skipped (skip=true). Only include events that were actually processed (accepted, hang-on extensions, read receipts).","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T11:52:15Z","created_by":"Juan Reyero","updated_at":"2026-02-08T12:18:11Z","closed_at":"2026-02-08T12:18:11Z","close_reason":"Implemented in commit c40f1b8: ChatStream/NetworkChatStream accept after param, Send passes sentAt timestamp, Listen passes nil, skipped replay events filtered from result.Events","dependencies":[{"issue_id":"aw-xab","depends_on_id":"aw-sb5","type":"blocks","created_at":"2026-02-18T16:59:14Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aw-y1s","title":"Skip wait when target is connected on reply","description":"When Send() sees all targets in TargetsConnected and caller didn't explicitly request waiting (no --start-conversation, no --wait), return immediately with 'delivered' status instead of opening SSE and waiting 120s. Also add Leaving to ChatSendMessageRequest and SenderWaiting to SSE event parsing.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T22:38:12Z","created_by":"Juan Reyero","updated_at":"2026-02-07T22:41:54Z","closed_at":"2026-02-07T22:41:54Z","close_reason":"All 3 phases implemented: (1) Skip wait when TargetsConnected, (2) Leaving on ChatSendMessageRequest, (3) SenderWaiting on SSE events. 37 tests pass."}
