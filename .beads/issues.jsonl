{"id":"aw-018","title":"Leaving field on ChatSendMessageRequest is dead wire","description":"Grace confirmed: POST /sessions/{id}/messages hardcodes sender_leaving=false server-side (chat.py:829). Only POST /v1/chat/sessions (ChatCreateSession) honors the leaving field. Our send-and-leave verb works because it uses ChatCreateSession, but the Leaving field we added to ChatSendMessageRequest in Phase A does nothing. Either remove it from the client type or ask grace to add server support.","status":"open","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T08:50:34.818714Z","created_by":"Juan Reyero","updated_at":"2026-02-08T08:50:34.818714Z"}
{"id":"aw-061","title":"Replace fragile mockHandler prefix matching in chat tests","description":"The mockHandler in chat_test.go uses map iteration (undefined order) for prefix matching of parameterized paths. This is fragile — if two handlers share a prefix, behavior is non-deterministic.\n\nSeveral tests already work around this with explicit path guards:\n  if r.URL.Path != \"/v1/chat/sessions\" { http.NotFound(w, r); return }\n\nThis pattern appears in TestOpenFallbackToListSessions, TestFindSessionFallback, TestFindSessionNotFound, TestFindSessionPrefersSmallestFallback, TestListenNoSession.\n\nFix: Replace prefix matching with proper path routing. Options:\n- Use http.ServeMux (Go 1.22+ supports method+path patterns)\n- Use exact matching only, register parameterized paths explicitly per test\n- Use a simple trie or ordered slice instead of a map\n\nFiles: chat/chat_test.go","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:25:16.39698Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:25:16.39698Z"}
{"id":"aw-0np","title":"Network chat send-and-wait doesn't wait (no SSE streaming)","description":"The network path for send-and-wait (org/alias addresses) calls NetworkCreateChat and returns immediately without opening an SSE stream. The server returns sse_url in the response but the client never connects to it. This means cross-org send-and-wait is actually fire-and-forget, violating the protocol rule: always wait unless the interlocutor left. The fix is to connect to the returned sse_url and wait for a reply, same as the OSS path does via chat.Send(). This would also fix the output schema inconsistency (network returns NetworkChatCreateResponse, OSS returns SendResult).","notes":"Ivy confirmed (aweb-cloud): SSE streaming works for network chat via /api/v1/network/chat/{session_id}/stream (cloud endpoint). The sse_url in NetworkChatCreateResponse already points there. Client needs same auth + deadline query param. Fix: after NetworkCreateChat(), open SSE stream at server_url+sse_url and wait, same as OSS path.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T08:37:51.61499Z","created_by":"Juan Reyero","updated_at":"2026-02-08T08:57:01.600553Z","closed_at":"2026-02-08T08:57:01.600553Z","close_reason":"SendNetwork() added with full SSE streaming. Both OSS and network paths share sendCommon() waiting logic. Output schema unified to SendResult. All tests pass."}
{"id":"aw-1qo","title":"Implement aw init cloud bootstrap fallback","description":"Update aw init to support hosted aweb-cloud where /v1/init is unavailable by falling back to authenticated cloud bootstrap endpoint.","design":"Keep OSS /v1/init as primary path. On 403/404 from init, call cloud /api/v1/agents/bootstrap using --cloud-token or AWEB_CLOUD_TOKEN, normalize /api base URLs, and preserve existing init output/config contract.","acceptance_criteria":"1) OSS init behavior unchanged. 2) Cloud fallback issues API key via /api/v1/agents/bootstrap. 3) Works when base URL includes /api. 4) Tests cover fallback success and missing-token failure.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-06T13:02:38.43577Z","created_by":"Juan Reyero","updated_at":"2026-02-06T13:02:49.3632Z","closed_at":"2026-02-06T13:02:49.3632Z","close_reason":"Closed"}
{"id":"aw-2yx","title":"Listen returns misleading Status 'sent' on timeout","description":"Listen returns SendResult with Status='sent' on timeout, but nothing was sent. The comment acknowledges this: 'Returns *SendResult for compatibility with existing formatting code.'\n\nThe semantic mismatch can confuse consumers. Consider:\n- Adding a ListenResult type (or using a more generic name like ChatResult)\n- Or at minimum, using Status='timeout' instead of 'sent' for Listen timeouts\n\nThis is low priority since it's an internal API used by cmd/aw/chat.go, but it will cause confusion if other consumers use the chat package.\n\nFiles: chat/chat.go (Listen), chat/types.go","status":"open","priority":4,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:25:20.980091Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:25:20.980091Z","dependencies":[{"issue_id":"aw-2yx","depends_on_id":"aw-w7a","type":"blocks","created_at":"2026-02-08T09:25:29.34442Z","created_by":"Juan Reyero"}]}
{"id":"aw-344","title":"Add 'aw mail ack' CLI command","description":"AckMessage() client method exists but no CLI command exposes it. Add 'aw mail ack' subcommand that calls POST /v1/messages/{message_id}/ack. Takes --message-id flag.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:06.273275Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.201816Z","closed_at":"2026-02-04T11:33:26.201816Z","close_reason":"Closed"}
{"id":"aw-43q","title":"Replace chat send with send-and-wait / send-and-leave verbs","description":"## Problem\n\nAgents get trapped in 120s waits because the default chat send behavior is ambiguous. When replying to a message, agents forget --leave-conversation and silently wait for a counter-reply that never comes.\n\n## Solution\n\nReplace the ambiguous chat send with two explicit verbs:\n\n- chat send-and-wait \u003calias\u003e \u003cmsg\u003e — send and wait for reply (120s default)\n  - --start-conversation: 5 min wait (initiating new exchange)\n  - --wait N: custom wait duration\n- chat send-and-leave \u003calias\u003e \u003cmsg\u003e — send with leaving=true, exit immediately\n\nRemove bare chat send entirely. Every send must declare intent.\n\n## Files to update\n\n### aw repo (this repo)\n- cmd/aw/chat.go: replace chatSendCmd with two new commands\n- cmd/aw/aw_test.go: update any chat send tests\n- README.md: update CLI docs\n- skills/aweb/SKILL.md: update command list\n- skills/aweb/resources/COORDINATION_PATTERNS.md: update examples\n\n### bdh repo (alice-coordinator)\n- internal/commands/chat.go: replace send subcommand with two verbs\n- internal/commands/chat_test.go: update tests\n- internal/commands/agent_docs.go: update help templates\n- README.md\n\n### beadhub repo (alice-coordinator)\n- src/beadhub/defaults/invariants/03-communication-chat.md: update subcommand table and examples\n- src/beadhub/defaults/roles/backend.md, frontend.md: update examples\n\n### aweb-cloud repo (ivy-implementer)\n- .release-deps/beadhub/: will get updated on next beadhub release\n\n### beadhub-sot\n- archive/beadhub-chat-spec.md: update CLI section","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:38:53.481501Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:43:48.637891Z","closed_at":"2026-02-07T23:43:48.637891Z","close_reason":"Implemented send-and-wait/send-and-leave CLI verbs, updated all docs and tests, notified all stakeholders. Branch feat/chat-send-and-wait-leave pushed."}
{"id":"aw-67s","title":"Harden aw init cloud mode token resolution and URL normalization","description":"Improve aw init cloud path by adding strict cloud mode, resilient cloud token selection across server-key/host mismatches, and /api/v1 normalization for cloud bootstrap.","design":"Add --cloud mode to skip /v1/init probing, broaden credential lookup order to include configured accounts by server key and URL host, and normalize cloud root URL for /api and /api/v1 suffixes. Add integration tests for each case.","acceptance_criteria":"1) --cloud mode never probes /v1/init. 2) Configured cloud token is found even when server key and URL host differ. 3) /api/v1 URLs bootstrap correctly. 4) Tests cover all scenarios.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-06T14:29:12.765284Z","created_by":"Juan Reyero","updated_at":"2026-02-06T14:29:30.59162Z","closed_at":"2026-02-06T14:29:30.59162Z","close_reason":"Closed"}
{"id":"aw-68m","title":"Migrate aw CLI from stdlib flag to cobra","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T13:51:52.982318Z","created_by":"Juan Reyero","updated_at":"2026-02-04T17:04:37.2508Z","closed_at":"2026-02-04T17:04:37.2508Z","close_reason":"Migrated from stdlib flag to spf13/cobra; flags now work in any position"}
{"id":"aw-7l4","title":"Add 'aw lock renew' CLI command","description":"ReservationRenew() client method exists but no CLI command exposes it. Add 'aw lock renew' subcommand that calls POST /v1/reservations/renew. Takes --resource-key and optional --ttl-seconds flags.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:06.66056Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.213143Z","closed_at":"2026-02-04T11:33:26.213143Z","close_reason":"Closed"}
{"id":"aw-8gi","title":"Fix inconsistent CLI error messages for missing flags","description":"runLockAcquire and runLockRelease say 'Missing required flags' (generic plural) while runLockRenew and runMailAck say 'Missing required flag: --flag-name' (specific). Standardize all missing-flag errors to name the specific missing flag.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:10.796835Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:13:39.566424Z","closed_at":"2026-02-06T18:13:39.566424Z","close_reason":"Standardized missing-flag errors and added --debug/AW_DEBUG for background error visibility"}
{"id":"aw-cnn","title":"Add 'aw agents' CLI command","description":"ListAgents() client method exists but no CLI command exposes it. Add 'aw agents' command that calls GET /v1/agents and outputs agent list as JSON. Response includes agent_id, alias, human_name, agent_type, status, last_seen, online.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:05.879432Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.191214Z","closed_at":"2026-02-04T11:33:26.191214Z","close_reason":"Closed"}
{"id":"aw-e1p","title":"Add --debug flag for heartbeat and background error visibility","description":"fireHeartbeat() silently swallows all errors. Agents may appear offline with no feedback. Add a --debug flag or AW_DEBUG env var that logs background errors (heartbeat failures, config resolution issues) to stderr.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:15.271576Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:13:39.568753Z","closed_at":"2026-02-06T18:13:39.568753Z","close_reason":"Standardized missing-flag errors and added --debug/AW_DEBUG for background error visibility"}
{"id":"aw-grj","title":"Add ReservationRevoke() client method and 'aw lock revoke' CLI command","description":"POST /v1/reservations/revoke endpoint has no Go client method. Add ReservationRevoke() to client library and 'aw lock revoke' CLI command. Request: {prefix (optional)}. Response: {revoked_count, revoked_keys}.","status":"closed","priority":3,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:09.409342Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.234668Z","closed_at":"2026-02-04T11:33:26.234668Z","close_reason":"Closed"}
{"id":"aw-j80","title":"Design: explicit send-and-wait / send-and-leave chat protocol","description":"## Problem\n\nAgents coordinating via chat get trapped in 120-second waits. The most common failure: an agent replies to a waiting sender but forgets --leave-conversation, blocking for 120s waiting for a counter-reply that never comes.\n\nThe deeper issue: the protocol doesn't propagate wait state. When you receive a message, you don't know if the sender is sitting there waiting for your response. And when you reply, the default behavior (wait 120s) assumes you're starting a new exchange, not answering one.\n\n## Correct Protocol\n\nThe rule is simple: **always wait after sending, unless the other party left in the previous round.**\n\n### Flow\n\n1. A sends and waits (--start-conversation, 5 min)\n2. B sees the message, sends reply and waits (default 120s)\n3. A gets B's reply. A knows B is waiting (sender_waiting=true in the SSE event). A thinks, writes back, and leaves (--leave-conversation).\n4. B receives A's reply plus the info that A is not waiting (sender_leaving=true). B either replies-and-leaves, or just stops.\n\nThe agent that ends the conversation MUST make it explicit. Otherwise the other agent will, by default, reply and wait — and get trapped.\n\n## What's Missing\n\n### 1. Receiving agent doesn't know if sender is waiting\n\nWhen B receives a message via SSE, the event doesn't include sender_waiting. B can't tell if A is sitting there expecting a reply or if A fired-and-forgot. This should be appended to every message event so the receiving agent always knows.\n\n### 2. Leaving can't be signaled via ChatSendMessage\n\nCurrently leaving can only be signaled via ChatCreateSession (alias-based). ChatSendMessage (session-ID-based) has no Leaving field, so there's no way to leave via the session-ID path. This is inconsistent with HangOn which works on both.\n\n### 3. Default behavior is ambiguous\n\nThe current flags are:\n- --start-conversation: wait 5 min\n- --leave-conversation: send and exit\n- (default): wait 120s\n\nThe problem is the default. \"wait 120s\" is correct for continuing a conversation but wrong for a final reply. Agents must remember to add --leave-conversation, and they forget.\n\nConsider making the intent more explicit, e.g.:\n- send-and-wait: \"I expect a reply, wait for it\"\n- send-and-leave: \"I'm done, don't wait\"\n\nThis removes the ambiguous default and forces every send to declare intent.\n\n## Implementation Phases\n\n### Phase A: Wire protocol gaps (client-only, backward compatible)\n\n1. Add Leaving field to ChatSendMessageRequest and NetworkChatSendMessageRequest (omitempty, server ignores unknown fields)\n2. Add SenderWaiting field to Event struct, parse sender_waiting from SSE events\n3. Add SenderWaiting to ChatSessionItem for when server starts including it\n\n### Phase B: Server-side sender_waiting propagation\n\nWhen B sends a message while waiting on SSE, the message event delivered to A should include sender_waiting: true. This lets A know B expects a reply. Server needs to:\n- Include sender_waiting in SSE message events\n- Include sender_waiting in ChatSessionItem (list sessions response)\n\n### Phase C: UX — make wait intent explicit\n\nEvaluate whether to replace the ambiguous default with explicit send-and-wait / send-and-leave semantics. This is a UX decision that affects how bdh :aweb chat commands work.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T22:51:54.004605Z","created_by":"Juan Reyero","updated_at":"2026-02-07T22:54:49.675755Z","closed_at":"2026-02-07T22:54:49.675755Z","close_reason":"Phase A wire protocol gaps implemented: Leaving on ChatSendMessage, SenderWaiting on SSE events, propagation to SendResult. Phases B (server) and C (UX) remain as future work."}
{"id":"aw-ktk","title":"Update usage() help text with new commands","description":"After adding agents, mail ack, lock renew, project, and lock revoke commands, update the usage() function in main.go to include them all.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:15.423781Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.245296Z","closed_at":"2026-02-04T11:33:26.245296Z","close_reason":"Closed"}
{"id":"aw-lmj","title":"Fix SSE goroutine leak in chat Send()","description":"In chat/chat.go Send(), streamToChannel() goroutine may leak if context cancels while it's reading from the SSE stream. defer stream.Close() may close the stream while the goroutine is still reading. Need explicit synchronization or errgroup to ensure clean shutdown.","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:04.190574Z","created_by":"Juan Reyero","updated_at":"2026-02-06T16:31:43.628759Z","closed_at":"2026-02-06T16:31:43.628759Z","close_reason":"Fixed goroutine leak in streamToChannel: returns cleanup func that closes stream, cancels goroutine, waits for exit. Channel sends use select to avoid blocking on full buffer."}
{"id":"aw-mq5","title":"Fix duplicate hang_on callback firing in sendCommon and Listen","description":"In both sendCommon and Listen, when a hang_on event arrives, the callback fires twice with confusingly different messages:\n\nWhen ExtendsWaitSeconds \u003e 0:\n  1. callback('hang_on', 'bob: thinking...')          — the body\n  2. callback('wait_extended', 'wait extended by 5 min (bob requested more time)')  — from extendWait\n\nWhen ExtendsWaitSeconds == 0:\n  1. callback('hang_on', 'bob: thinking...')          — the body\n  2. callback('hang_on', 'bob requested more time')   — from the else-if branch\n\nThe second callback in the ExtendsWaitSeconds==0 case is redundant — the first callback already conveyed the hang_on with the body.\n\nFix: Remove the else-if branch (lines 399-401 in sendCommon, equivalent in Listen). The first callback('hang_on', body) is sufficient. The wait_extended callback from extendWait is useful and should stay.\n\nFiles: chat/chat.go (two locations — but should become one after issue 1 is fixed)","status":"in_progress","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:25:02.352004Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:37:36.445881Z","dependencies":[{"issue_id":"aw-mq5","depends_on_id":"aw-w7a","type":"blocks","created_at":"2026-02-08T09:25:27.523953Z","created_by":"Juan Reyero"}]}
{"id":"aw-mwx","title":"Split main.go into per-command files","description":"cmd/aw/main.go is 1000+ lines with all CLI command handlers. Split into separate files by command group (e.g. mail.go, chat.go, lock.go, agents.go) for maintainability. Keep main() and usage() in main.go.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:12.972738Z","created_by":"Juan Reyero","updated_at":"2026-02-04T17:04:36.871956Z","closed_at":"2026-02-04T17:04:36.871956Z","close_reason":"Split main.go into per-command files as part of cobra migration"}
{"id":"aw-n5m","title":"Chat operations (Listen/Open/History/HangOn/ShowPending) fail for network addresses","description":"All chat operations except Send go through findSession(), which only queries OSS endpoints (/v1/chat/pending, /v1/chat/sessions). Network conversations live at /api/v1/network/chat/... endpoints.\n\nImpact: 'aw chat listen acme/bot', 'aw chat open acme/bot', 'aw chat history acme/bot', 'aw chat hang-on acme/bot msg', and 'aw chat show-pending acme/bot' all fail with 'no conversation found'.\n\nOnly chatSend in cmd/aw/chat.go:24-31 correctly routes between OSS and network paths. All other operations need equivalent routing.\n\nFix approach:\n1. findSession needs a network-aware variant (or a flag/separate function) that queries NetworkChatPending and network session list endpoints\n2. Listen needs a network variant (like SendNetwork is to Send) that uses client.NetworkChatStream instead of client.ChatStream\n3. Open, History, HangOn, ShowPending need network routing at the cmd/aw/chat.go level (like chatSend does with ParseNetworkAddress)\n4. The underlying network client methods for pending/history/mark-read already exist in network.go\n\nFiles: chat/chat.go, cmd/aw/chat.go, network.go","status":"open","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:24:55.658629Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:24:55.658629Z"}
{"id":"aw-nv6","title":"Make worktree context file writes atomic","description":"awconfig/context.go SaveWorktreeContextTo() uses os.WriteFile directly, unlike global config which uses temp-file-and-rename. Process kill during write could corrupt the context file. Should use the same atomic write pattern as global_config.go.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:08.259993Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:02:04.991052Z","closed_at":"2026-02-06T18:02:04.991052Z","close_reason":"Extracted atomicWriteFile() helper with chmod-before-write pattern. Both SaveGlobalTo and SaveWorktreeContextTo now use it."}
{"id":"aw-oo0","title":"Fix config temp file permissions window","description":"In awconfig/global_config.go, os.CreateTemp uses default umask before API key data is written. There's a brief window where the temp file may have overly permissive mode. Should explicitly chmod the temp file before writing sensitive data, or use os.OpenFile with restrictive mode.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T12:25:06.461644Z","created_by":"Juan Reyero","updated_at":"2026-02-06T18:02:04.989149Z","closed_at":"2026-02-06T18:02:04.989149Z","close_reason":"Extracted atomicWriteFile() helper with chmod-before-write pattern. Both SaveGlobalTo and SaveWorktreeContextTo now use it."}
{"id":"aw-p1b","title":"Refactor chat CLI: positional args and rename --leaving","description":"Per alignment with Alice (bdh-2et): (1) Change chat subcommands to use positional args for required params (alias, message) instead of flags. (2) Rename --leaving to --leave-conversation on chat send. (3) Update usage() text. (4) Update tests. Affects: runChatSend, runChatOpen, runChatHistory, runChatHangOn, runChatShowPending.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T13:06:15.072938Z","created_by":"Juan Reyero","updated_at":"2026-02-04T13:09:43.551718Z","closed_at":"2026-02-04T13:09:43.551718Z","close_reason":"All 5 chat subcommands refactored to positional args, --leaving renamed to --leave-conversation, usage text updated, tests pass."}
{"id":"aw-q3q","title":"TestSendStartConversationUpgradesWhenNotExplicit doesn't verify the upgrade","description":"The test sets a 2s context timeout and Wait=DefaultWait (120s). It expects context.DeadlineExceeded to prove the wait was upgraded to 300s. But the test would produce the identical result without the upgrade — the context (2s) is shorter than DefaultWait (120s), so it would always hit DeadlineExceeded regardless.\n\nThe test proves nothing beyond 'Send waits at all', which is already tested by TestSendWithTimeout.\n\nFix: The test needs to actually observe the difference between 120s and 300s wait. Options:\n- Mock the timer or inject a clock to verify the configured timeout\n- Use a short Wait value (e.g., 1s) so the test can distinguish between 'waited 1s' (no upgrade) and 'waited longer' (upgraded to 300s)\n- Capture the wait timer value through the callback or result\n\nFiles: chat/chat_test.go (TestSendStartConversationUpgradesWhenNotExplicit)","status":"open","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:25:09.69352Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:25:09.69352Z"}
{"id":"aw-sw6","title":"Add GetCurrentProject() client method and 'aw project' CLI command","description":"GET /v1/projects/current endpoint has no Go client method. Add GetCurrentProject() to client library and 'aw project' CLI command. Response: {project_id, slug, name}.","status":"closed","priority":3,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-04T11:23:07.861134Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:33:26.223899Z","closed_at":"2026-02-04T11:33:26.223899Z","close_reason":"Closed"}
{"id":"aw-w7a","title":"Extract shared wait loop from sendCommon and Listen to eliminate duplication","description":"Listen() in chat/chat.go:422-537 is a ~115-line copy-paste of the wait loop from sendCommon() (chat/chat.go:233-419). The extendWait closure is 100% identical. The event processing loop is nearly identical, differing only in: (1) no seenSentMessage replay-skip logic, (2) no target-filtering (returns on any message), (3) no SenderWaiting propagation.\n\nFix: Extract a shared waitForReply/waitForEvent function that accepts the differences as parameters — e.g., a message filter function, whether to skip replays, the sent message ID. Both sendCommon and Listen should call this shared function.\n\nFiles: chat/chat.go\nScope: ~115 lines of duplicated code → single shared implementation","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:24:46.478138Z","created_by":"Juan Reyero","updated_at":"2026-02-08T09:37:29.975784Z","closed_at":"2026-02-08T09:37:29.975784Z","close_reason":"Extracted waitForMessage function, Listen reduced from ~115 to ~15 lines. All 36 tests pass."}
{"id":"aw-y1s","title":"Skip wait when target is connected on reply","description":"When Send() sees all targets in TargetsConnected and caller didn't explicitly request waiting (no --start-conversation, no --wait), return immediately with 'delivered' status instead of opening SSE and waiting 120s. Also add Leaving to ChatSendMessageRequest and SenderWaiting to SSE event parsing.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T22:38:11.926959Z","created_by":"Juan Reyero","updated_at":"2026-02-07T22:41:53.865428Z","closed_at":"2026-02-07T22:41:53.865428Z","close_reason":"All 3 phases implemented: (1) Skip wait when TargetsConnected, (2) Leaving on ChatSendMessageRequest, (3) SenderWaiting on SSE events. 37 tests pass."}
